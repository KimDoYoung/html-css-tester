<!DOCTYPE html>
<html lang="ko">
<!-- 
===========================================
ğŸ” AView Document Metadata
===========================================
Generated : 2025-11-25 09:14:43
Hashcode  : c1dd492fb2a6e923f7a6fa0701eb80d6
Filename  : lucy.md
Template  : markdown.html
===========================================
-->    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lucy.md</title>
    <link rel="icon" type="image/png" href="/aview/images/favicon32.png" sizes="32x32">
    <!-- Google Fonts: Noto Sans KR -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- GitHub Markdown CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.2.0/github-markdown.min.css">
    
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    
    <!-- html2pdf.js for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }

        .markdown-container {
            min-height: 70vh;
            max-width: 1200px;
            margin: 0 auto;
        }

        .doc-info-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .doc-info-section.collapsed {
            max-height: 0;
            padding: 0 20px;
            margin-bottom: 0;
            opacity: 0;
        }

        .toggle-doc-info-btn {
            background: #0d6efd;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .toggle-doc-info-btn {
                display: none;
            }
        }

        .toggle-doc-info-btn-mobile {
            background: #0d6efd;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            flex-shrink: 0;
        }

        @media (max-width: 768px) {
            .toggle-doc-info-btn-mobile {
                display: flex;
            }
        }

        .toggle-doc-info-btn-mobile:hover {
            background: #0b5ed7;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .toggle-doc-info-btn-mobile.collapsed {
            background: #28a745;
            animation: pulseCollapsed 2s ease-in-out infinite;
        }

        .toggle-doc-info-btn-mobile.collapsed:hover {
            background: #218838;
        }

        .toggle-doc-info-btn-mobile svg {
            color: white;
            width: 20px;
            height: 20px;
            transition: transform 0.3s ease;
        }

        .toggle-doc-info-btn-mobile.collapsed svg {
            transform: rotate(180deg);
        }

        .toggle-doc-info-btn:hover {
            background: #0b5ed7;
            transform: scale(1.1);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        .toggle-doc-info-btn:active {
            transform: scale(0.95);
            transition: all 0.1s ease;
        }

        .toggle-doc-info-btn svg {
            color: white;
            font-size: 1.1rem;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .toggle-doc-info-btn.collapsed {
            background: #28a745;
            animation: pulseCollapsed 2s ease-in-out infinite;
        }

        .toggle-doc-info-btn.collapsed:hover {
            background: #218838;
        }

        .toggle-doc-info-btn.collapsed svg {
            transform: rotate(180deg);
        }

        @keyframes pulseCollapsed {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            }
            50% {
                box-shadow: 0 4px 16px rgba(40, 167, 69, 0.4);
            }
        }

        .info-item {
            display: flex;
            flex-direction: column;
            margin-bottom: 0;
        }

        .info-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.875rem;
            margin-bottom: 0;
        }

        .info-value {
            color: #6c757d;
            font-size: 1.125rem;
        }

        .doc-info-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        @media (max-width: 1024px) {
            .doc-info-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .doc-info-row {
                grid-template-columns: 1fr;
            }
        }

        .doc-info-col {
            padding: 0;
        }

        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 10;
            min-width: 200px;
        }

        .mobile-menu.open {
            display: block;
        }

        .mobile-menu button {
            display: flex;
            align-items: center;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            transition: background-color 0.2s;
        }

        .mobile-menu button:hover {
            background-color: #f3f4f6;
        }

        .mobile-menu button svg {
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
        }

        .doc-info-header {
            background-color: #f2ebd3;
            padding: 12px 16px;
            margin: -20px -20px 16px -20px;
            border-radius: 8px 8px 0 0;
        }

        .doc-info-header h3 {
            margin: 0;
            color: #333;
            font-size: 1rem;
            font-weight: 600;
        }

        /* Markdown content styling */
        .markdown-body {
            box-sizing: border-box;
            min-width: 200px;
            max-width: 100%;
            margin: 0 auto;
            padding: 45px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .markdown-body {
                padding: 20px;
            }
        }

        /* Code block styling */
        .markdown-body pre {
            background-color: #f6f8fa;
            border-radius: 6px;
            padding: 16px;
            overflow: auto;
        }

        .markdown-body code {
            background-color: rgba(110,118,129,0.1);
            padding: 0.2em 0.4em;
            border-radius: 3px;
            font-size: 85%;
        }

        .markdown-body pre code {
            background-color: transparent;
            padding: 0;
        }

        /* Table styling */
        .markdown-body table {
            border-collapse: collapse;
            width: 100%;
            margin: 1em 0;
        }

        .markdown-body table th,
        .markdown-body table td {
            border: 1px solid #d0d7de;
            padding: 6px 13px;
        }

        .markdown-body table tr:nth-child(2n) {
            background-color: #f6f8fa;
        }

        /* Heading anchor links */
        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3,
        .markdown-body h4,
        .markdown-body h5,
        .markdown-body h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            line-height: 1.25;
        }

        .markdown-body h1 {
            font-size: 2em;
            border-bottom: 1px solid #d0d7de;
            padding-bottom: 0.3em;
        }

        .markdown-body h2 {
            font-size: 1.5em;
            border-bottom: 1px solid #d0d7de;
            padding-bottom: 0.3em;
        }

        /* Control Bar Styles */
        .text-viewer-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 40px;
            padding: 0 12px;
            background-color: #f0f0f0;
            border: 1px solid #d0d0d0;
            gap: 8px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .controls-desktop {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .controls-mobile {
            display: none;
            position: relative;
            margin-left: auto;
        }

        @media (max-width: 768px) {
            .controls-desktop {
                display: none;
            }

            .controls-mobile {
                display: flex;
            }
        }

        .control-item {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            white-space: nowrap;
            cursor: pointer;
        }

        .control-btn {
            padding: 4px 8px;
            min-width: 30px;
            height: 28px;
            background-color: #e8e8e8;
            border: 1px solid #c0c0c0;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .control-btn:hover {
            background-color: #d8d8d8;
        }

        .control-btn:active {
            background-color: #c8c8c8;
        }

        .control-select {
            padding: 4px 6px;
            height: 28px;
            font-size: 12px;
            border: 1px solid #c0c0c0;
            border-radius: 4px;
            background-color: #ffffff;
            cursor: pointer;
        }

        .btn-group {
            display: inline-flex;
            gap: 0;
        }

        .btn-group .control-btn {
            border-radius: 0;
            margin-left: -1px;
        }

        .btn-group .control-btn:first-child {
            border-radius: 4px 0 0 4px;
            margin-left: 0;
        }

        .btn-group .control-btn:last-child {
            border-radius: 0 4px 4px 0;
        }

        /* Custom Color Dropdown */
        .custom-color-dropdown {
            position: relative;
            display: inline-flex;
            align-items: center;
        }

        .custom-color-btn {
            width: 28px;
            height: 28px;
            border: 2px solid #333;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0;
            background-color: #ffffff;
        }

        .custom-color-menu {
            display: none;
            position: absolute;
            top: 32px;
            left: 0;
            background: white;
            border: 1px solid #c0c0c0;
            border-radius: 4px;
            padding: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            z-index: 1000;
            gap: 6px;
        }

        .custom-color-menu.open {
            display: flex;
        }

        .custom-color-option {
            width: 24px;
            height: 24px;
            border: 1px solid #c0c0c0;
            border-radius: 3px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .custom-color-option:hover {
            transform: scale(1.15);
            border-width: 2px;
            border-color: #666;
        }

        .custom-color-option.active {
            border: 2px solid #333;
            box-shadow: 0 0 0 2px white, 0 0 0 3px #333;
        }

        /* Search Box */
        .search-box {
            display: flex;
            align-items: center;
            gap: 4px;
            background-color: #ffffff;
            border: 1px solid #c0c0c0;
            border-radius: 4px;
            padding: 2px 6px;
            height: 28px;
        }

        .search-input {
            border: none;
            outline: none;
            font-size: 12px;
            padding: 4px;
            width: 120px;
            background: transparent;
        }

        .search-btn, .search-clear-btn {
            background: none;
            border: none;
            padding: 2px 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 3px;
        }
        
        .search-clear-btn {
            display: none;
        }

        .search-clear-btn.visible {
            display: flex;
        }

        .search-btn svg, .search-clear-btn svg {
            width: 14px;
            height: 14px;
            color: #666;
        }

        .search-counter {
            font-size: 11px;
            color: #666;
            min-width: 35px;
            text-align: center;
        }

        .search-highlight {
            background-color: #ffff00;
            color: #000;
        }

        .search-highlight.current {
            background-color: #ff9500;
            color: #fff;
        }

        /* Dark Mode */
        body.dark-mode {
            background-color: #0d1117;
            color: #c9d1d9;
        }

        body.dark-mode .markdown-body {
            background-color: #0d1117;
            color: #c9d1d9;
            border-color: #30363d;
        }
        
        body.dark-mode .text-viewer-controls {
            background-color: #161b22;
            border-color: #30363d;
        }

        body.dark-mode .control-btn, 
        body.dark-mode .control-select,
        body.dark-mode .search-box {
            background-color: #21262d;
            border-color: #30363d;
            color: #c9d1d9;
        }

        body.dark-mode .doc-info-section {
            background-color: #161b22;
            border-color: #30363d;
        }
        
        body.dark-mode .doc-info-header {
            background-color: #21262d;
        }
        
        body.dark-mode .info-label {
            color: #8b949e;
        }
        
        body.dark-mode .info-value {
            color: #c9d1d9;
        }

        /* Fullscreen */
        .markdown-container.fullscreen-mode {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            max-width: 100%;
            height: 100%;
            margin: 0;
            padding: 20px;
            z-index: 9999;
            background: white;
            overflow: auto;
        }
        
        body.dark-mode .markdown-container.fullscreen-mode {
            background: #0d1117;
        }

        /* Mobile Menu */
        .controls-dropdown {
            display: none;
            position: absolute;
            top: 40px;
            right: 0;
            background-color: white;
            border: 1px solid #c0c0c0;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            z-index: 100;
            min-width: 200px;
            padding: 8px;
            flex-direction: column;
            gap: 8px;
        }

        .controls-dropdown.open {
            display: flex;
        }
        /* Top Button Style */
        #topBtn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 40px;
            height: 40px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, background-color 0.2s;
            z-index: 1000;
        }

        #topBtn.show {
            opacity: 1;
            visibility: visible;
        }

        #topBtn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        body.dark-mode #topBtn {
            background-color: #238636;
        }

        body.dark-mode #topBtn:hover {
            background-color: #2ea043;
        }

        /* Floating TOC Button */
        #tocFloatingBtn {
            position: fixed;
            bottom: 80px; /* Above Top Button */
            right: 30px;
            width: 40px;
            height: 40px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, background-color 0.2s;
            z-index: 1000;
        }

        #tocFloatingBtn.show {
            opacity: 1;
            visibility: visible;
        }

        #tocFloatingBtn:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        body.dark-mode #tocFloatingBtn {
            background-color: #30363d;
        }

        body.dark-mode #tocFloatingBtn:hover {
            background-color: #484f58;
        }

        /* Table of Contents (TOC) Drawer */
        .toc-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .toc-overlay.open {
            opacity: 1;
            visibility: visible;
        }

        .toc-drawer {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
            z-index: 1002;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .toc-drawer.open {
            right: 0;
        }

        .toc-drawer.left {
            right: auto;
            left: -300px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            transition: left 0.3s ease;
        }

        .toc-drawer.left.open {
            left: 0;
            right: auto;
        }

        .toc-header {
            padding: 16px;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toc-header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .toc-position-selector {
            display: flex;
            gap: 12px;
            font-size: 0.85rem;
            font-weight: normal;
        }

        .toc-position-selector label {
            display: flex;
            align-items: center;
            gap: 4px;
            cursor: pointer;
        }

        .toc-close-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2rem;
            color: #666;
        }

        .toc-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .toc-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .toc-item {
            margin-bottom: 8px;
        }

        .toc-link {
            text-decoration: none;
            color: #333;
            display: block;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background-color 0.2s;
            font-size: 0.9rem;
        }

        .toc-link:hover {
            background-color: #f5f5f5;
            color: #0366d6;
        }

        .toc-item.h1 { margin-left: 0; font-weight: 600; }
        .toc-item.h2 { margin-left: 12px; }
        .toc-item.h3 { margin-left: 24px; }
        .toc-item.h4 { margin-left: 36px; }
        .toc-item.h5 { margin-left: 48px; }
        .toc-item.h6 { margin-left: 60px; }

        body.dark-mode .toc-drawer {
            background-color: #1e1e1e;
            color: #c9d1d9;
        }

        body.dark-mode .toc-header {
            border-bottom-color: #30363d;
        }

        body.dark-mode .toc-close-btn {
            color: #8b949e;
        }

        body.dark-mode .toc-link {
            color: #c9d1d9;
        }

        body.dark-mode .toc-link:hover {
            background-color: #30363d;
            color: #58a6ff;
        }

        /* Code Block Copy Button */
        .markdown-body pre {
            position: relative;
        }

        .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            color: #666;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s, background-color 0.2s;
            z-index: 10;
        }

        .markdown-body pre:hover .copy-btn {
            opacity: 1;
        }

        .copy-btn:hover {
            background-color: #fff;
            color: #0366d6;
        }

        body.dark-mode .copy-btn {
            background-color: rgba(30, 30, 30, 0.8);
            border-color: #444;
            color: #aaa;
        }

        body.dark-mode .copy-btn:hover {
            background-color: #333;
            color: #58a6ff;
        }

        /* Export Dropdown */
        .export-dropdown {
            position: relative;
            display: inline-block;
        }

        .export-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 4px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            min-width: 150px;
            z-index: 1000;
        }

        .export-menu.show {
            display: block;
        }

        .export-menu button {
            display: block;
            width: 100%;
            padding: 8px 16px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 13px;
            color: #333;
        }

        .export-menu button:hover {
            background-color: #f5f5f5;
        }

        body.dark-mode .export-menu {
            background-color: #2d2d2d;
            border-color: #444;
        }

        body.dark-mode .export-menu button {
            color: #e6e6e6;
        }

        body.dark-mode .export-menu button:hover {
            background-color: #3d3d3d;
        }

        /* Image Lightbox */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: zoom-out;
        }

        .lightbox-overlay.active {
            display: flex;
        }

        .lightbox-content {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            cursor: default;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
            transition: opacity 0.2s;
        }

        .lightbox-close:hover {
            opacity: 0.7;
        }

        .markdown-body img {
            cursor: zoom-in;
            transition: opacity 0.2s;
        }

        .markdown-body img:hover {
            opacity: 0.9;
        }
    </style>
</head>
<body>


    <!-- Header ì˜ì—­: ì „ì²´ ë„ˆë¹„ (100%) -->
    <div class="w-full bg-gray-100 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between gap-4">
                <!-- ì™¼ìª½: íŒŒì¼ëª… -->
                <div class="flex-1 min-w-0">
                    <h1 class="text-2xl font-bold text-gray-900 truncate">lucy.md</h1>
                </div>

                <!-- ì˜¤ë¥¸ìª½: ë°ìŠ¤í¬í†± ë²„íŠ¼ (md ì´ìƒì—ì„œë§Œ í‘œì‹œ) -->
                <div class="hidden md:flex gap-3 flex-shrink-0">
                    <!-- ì›ë³¸ ë‹¤ìš´ë¡œë“œ -->
                    <button type="button"
                            onclick="downloadOriginal()"
                            class="inline-flex items-center px-4 py-2 rounded-lg bg-green-600 text-white font-medium text-sm hover:bg-green-700 transition-colors shadow-sm whitespace-nowrap">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                        ì›ë³¸ ë‹¤ìš´ë¡œë“œ
                    </button>

                    <!-- ë¬¸ì„œ ì •ë³´ í† ê¸€ ë²„íŠ¼ -->
                    <button type="button"
                            class="toggle-doc-info-btn collapsed"
                            id="toggleDocInfoBtn"
                            onclick="toggleDocInfo()"
                            title="ë¬¸ì„œ ì •ë³´ ë³´ê¸°"
                            aria-label="ë¬¸ì„œ ì •ë³´ í† ê¸€">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </button>
                </div>

                <!-- ì˜¤ë¥¸ìª½: ëª¨ë°”ì¼ ì˜ì—­ (í† ê¸€ ë²„íŠ¼ + í–„ë²„ê±° ë©”ë‰´) -->
                <div class="md:hidden flex gap-2 items-center flex-shrink-0">
                    <!-- ëª¨ë°”ì¼ í† ê¸€ ë²„íŠ¼ -->
                    <button type="button"
                            class="toggle-doc-info-btn-mobile collapsed"
                            id="toggleDocInfoBtnMobile"
                            onclick="toggleDocInfo()"
                            title="ë¬¸ì„œ ì •ë³´ ë³´ê¸°"
                            aria-label="ë¬¸ì„œ ì •ë³´ í† ê¸€">
                        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
                        </svg>
                    </button>

                    <!-- í–„ë²„ê±° ë©”ë‰´ (relative ë˜í¼) -->
                    <div class="relative">
                        <button type="button"
                                id="mobileMenuBtn"
                                onclick="toggleMobileMenu()"
                                title="ë©”ë‰´"
                                aria-label="ì‘ì—… ë©”ë‰´ ì—´ê¸°"
                                class="p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition-colors">
                            <svg class="w-6 h-6 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                            </svg>
                        </button>

                        <!-- ëª¨ë°”ì¼ ë“œë¡­ë‹¤ìš´ ë©”ë‰´ -->
                        <div id="mobileMenu" class="mobile-menu">
                            <button type="button" onclick="downloadOriginal(); toggleMobileMenu();">
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                                ì›ë³¸ ë‹¤ìš´ë¡œë“œ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="markdown-container px-4 sm:px-6 lg:px-8 py-6" id="markdownContainer">
        
        <!-- Control Bar -->
        <div class="text-viewer-controls">
            <!-- Desktop Controls -->
            <div class="controls-desktop">
                <!-- Search Box -->
                <div class="search-box">
                    <input type="text" class="search-input" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" autocomplete="off">
                    <button type="button" class="search-btn" id="searchBtn" title="ë‹¤ìŒ ì°¾ê¸° (Enter)">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    </button>
                    <button type="button" class="search-clear-btn" id="searchClearBtn" title="ê²€ìƒ‰ ì§€ìš°ê¸°">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                    <span class="search-counter" id="searchCounter"></span>
                </div>

                <!-- Font Size -->
                <div class="control-item btn-group">
                    <button type="button" id="fontSizeDecrease" class="control-btn" title="í°íŠ¸ ì‘ê²Œ">âˆ’</button>
                    <button type="button" id="fontSizeReset" class="control-btn" title="í°íŠ¸ê¸°ë³¸(16px)">16px</button>
                    <button type="button" id="fontSizeIncrease" class="control-btn" title="í°íŠ¸ í¬ê²Œ">+</button>
                </div>

                <!-- Font Family -->
                <select id="fontFamily" class="control-select" title="í°íŠ¸ ì„ íƒ">
                    <option value="'Noto Sans KR', sans-serif" selected>Noto Sans KR</option>
                    <option value="'Malgun Gothic', 'ë§‘ì€ ê³ ë”•'">ë§‘ì€ ê³ ë”•</option>
                    <option value="'SeoulNamsan', sans-serif">ì„œìš¸ ë‚¨ì‚°ì²´</option>
                    <option value="'Courier New', monospace">Courier New</option>
                </select>

                <!-- Background Color -->
                <div class="custom-color-dropdown">
                    <button type="button" class="custom-color-btn" id="bgColorBtn" data-color="#ffffff" title="ë°°ê²½ìƒ‰ ì„ íƒ" style="background-color: #ffffff;"></button>
                    <div class="custom-color-menu" id="bgColorMenu">
                        <button type="button" class="custom-color-option active" data-color="#ffffff" style="background-color: #ffffff;" title="í°ìƒ‰"></button>
                        <button type="button" class="custom-color-option" data-color="#f5f5f5" style="background-color: #f5f5f5;" title="ë¼ì´íŠ¸ ê·¸ë ˆì´"></button>
                        <button type="button" class="custom-color-option" data-color="#fffacd" style="background-color: #fffacd;" title="ë¼ì´íŠ¸ ì˜ë¡œìš°"></button>
                        <button type="button" class="custom-color-option" data-color="#e6f3ff" style="background-color: #e6f3ff;" title="ë¼ì´íŠ¸ ë¸”ë£¨"></button>
                        <button type="button" class="custom-color-option" data-color="#f0f8f0" style="background-color: #f0f8f0;" title="ë¼ì´íŠ¸ ê·¸ë¦°"></button>
                    </div>
                </div>

                <!-- Line Height -->
                <div class="control-item btn-group">
                    <button type="button" id="lineHeightDecrease" class="control-btn" title="ì¤„ê°„ ì‘ê²Œ">âˆ’</button>
                    <button type="button" id="lineHeightReset" class="control-btn" title="ì¤„ê°„ ê¸°ë³¸">âœ±</button>
                    <button type="button" id="lineHeightIncrease" class="control-btn" title="ì¤„ê°„ í¬ê²Œ">+</button>
                </div>

                <!-- Fullscreen -->
                <button type="button" id="toggleFullscreen" class="control-btn" title="ì „ì²´í™”ë©´">â›¶</button>

                <!-- Dark Mode -->
                <button type="button" id="toggleDarkMode" class="control-btn" title="ë‹¤í¬ëª¨ë“œ">ğŸŒ™</button>

                <!-- TOC Position -->
                <div class="control-item" style="display: flex; align-items: center; gap: 4px; font-size: 12px;">
                    <span style="margin-right: 4px;">ë©”ë‰´:</span>
                    <label style="display: flex; align-items: center; gap: 2px; cursor: pointer;">
                        <input type="radio" name="tocPosition" value="left" id="tocPosLeft">
                        <span>ì™¼ìª½</span>
                    </label>
                    <label style="display: flex; align-items: center; gap: 2px; cursor: pointer;">
                        <input type="radio" name="tocPosition" value="right" id="tocPosRight" checked>
                        <span>ì˜¤ë¥¸ìª½</span>
                    </label>
                </div>

                <!-- TOC Toggle (Icon Only) -->
                <button type="button" class="control-btn" id="tocToggleBtnDesktop" title="ëª©ì°¨">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>

                <!-- Raw Markdown Toggle -->
                <button type="button" class="control-btn" id="rawToggleBtn" title="Raw Markdown">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                    </svg>
                </button>

                <!-- Export Dropdown -->
                <div class="export-dropdown">
                    <button type="button" class="control-btn" id="exportBtn" title="ë‚´ë³´ë‚´ê¸°">
                        <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                        </svg>
                    </button>
                    <div class="export-menu" id="exportMenu">
                        <button type="button" id="exportHTML">ğŸ“„ HTML ë‚´ë³´ë‚´ê¸°</button>
                        <button type="button" id="exportPDF">ğŸ“„ PDF ë‚´ë³´ë‚´ê¸°</button>
                    </div>
                </div>

                <!-- Settings -->
                <div class="control-item btn-group">
                    <button type="button" id="saveSettings" class="control-btn" title="ì„¤ì • ì €ì¥">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                    </button>
                    <button type="button" id="resetSettings" class="control-btn" title="ì„¤ì • ì´ˆê¸°í™”">
                        <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Controls Menu -->
            <div class="controls-mobile">
                <!-- Mobile TOC Button (Left) -->
                <button type="button" id="tocToggleBtnMobile" class="control-btn" title="ëª©ì°¨">
                    <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
                
                <!-- Mobile Settings Menu Button (Right) -->
                <button type="button" id="controlsMenuBtn" class="control-btn" title="ì„¤ì •">â‹¯</button>
                <div id="controlsMenu" class="controls-dropdown">
                    <!-- Mobile Search -->
                    <div class="search-box">
                        <input type="text" class="search-input" id="searchInput-mobile" placeholder="ê²€ìƒ‰" autocomplete="off">
                        <button type="button" class="search-btn" id="searchBtn-mobile"><svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                    </div>
                    
                    <!-- Mobile Font Size -->
                    <div class="control-item btn-group">
                        <button type="button" id="fontSizeDecrease-mobile" class="control-btn">âˆ’</button>
                        <button type="button" id="fontSizeReset-mobile" class="control-btn">16px</button>
                        <button type="button" id="fontSizeIncrease-mobile" class="control-btn">+</button>
                    </div>
                    
                    <!-- Mobile Font Family -->
                    <select id="fontFamily-mobile" class="control-select" title="í°íŠ¸ ì„ íƒ">
                        <option value="'Noto Sans KR', sans-serif" selected>Noto Sans KR</option>
                        <option value="'Malgun Gothic', 'ë§‘ì€ ê³ ë”•'">ë§‘ì€ ê³ ë”•</option>
                        <option value="'SeoulNamsan', sans-serif">ì„œìš¸ ë‚¨ì‚°ì²´</option>
                        <option value="'Courier New', monospace">Courier New</option>
                    </select>
                    
                    <!-- Mobile Line Height -->
                    <div class="control-item btn-group">
                        <button type="button" id="lineHeightDecrease-mobile" class="control-btn" title="ì¤„ê°„ ì‘ê²Œ">âˆ’</button>
                        <button type="button" id="lineHeightReset-mobile" class="control-btn" title="ì¤„ê°„ ê¸°ë³¸">âœ±</button>
                        <button type="button" id="lineHeightIncrease-mobile" class="control-btn" title="ì¤„ê°„ í¬ê²Œ">+</button>
                    </div>
                    
                    <!-- Mobile Dark Mode -->
                    <button type="button" id="toggleDarkMode-mobile" class="control-btn">ğŸŒ™ ë‹¤í¬ëª¨ë“œ</button>
                    
                    <!-- Mobile Settings Save/Reset -->
                    <div class="control-item btn-group">
                        <button type="button" id="saveSettings-mobile" class="control-btn" title="ì„¤ì • ì €ì¥">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                            ì €ì¥
                        </button>
                        <button type="button" id="resetSettings-mobile" class="control-btn" title="ì„¤ì • ì´ˆê¸°í™”">
                            <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                            ì´ˆê¸°í™”
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ë¬¸ì„œ ì •ë³´ ì„¹ì…˜ (ì´ˆê¸°: ìˆ¨ê¹€) -->
        <div id="docInfoSection" class="doc-info-section collapsed">
            <!-- Markdown ì •ë³´ í—¤ë” -->
            <div class="doc-info-header">
                <h3>Markdown ì •ë³´</h3>
            </div>

            <div class="doc-info-row">
                <div class="doc-info-col">
                    <div class="info-item">
                        <span class="info-label">íŒŒì¼ í¬ê¸°</span>
                        <span class="info-value">41,838 bytes</span>
                    </div>
                </div>
                <div class="doc-info-col">
                    <div class="info-item">
                        <span class="info-label">ì´ ë¼ì¸ ìˆ˜</span>
                        <span class="info-value" id="lineCountValue">859</span>
                    </div>
                </div>
                <div class="doc-info-col">
                    <div class="info-item">
                        <span class="info-label">ì´ ë¬¸ì ìˆ˜</span>
                        <span class="info-value" id="charCountValue">27,622</span>
                    </div>
                </div>
                <div class="doc-info-col">
                    <div class="info-item">
                        <span class="info-label">ì¸ì½”ë”©</span>
                        <span class="info-value">UTF-8</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Markdown ë Œë”ë§ ì˜ì—­ -->
        <div class="markdown-body"><h1>OMS(Lucy) í”„ë¡œì íŠ¸</h1>
<h2>1. Lucy í”„ë¡œì íŠ¸ì˜ ê°œìš”</h2>
<h3>1.1 í”„ë¡œì íŠ¸ì˜ ëª…ì¹­</h3>
<p>OMS(ì£¼ë¬¸ê´€ë¦¬ì‹œìŠ¤í…œ)ì„ ì¶”êµ¬í•˜ë©´ì„œ ê°œë°œë˜ì—ˆìœ¼ë©° ê°œë°œì½”ë“œëª…ìœ¼ë¡œ Lucyë¼ëŠ” ëª…ì¹­ì„ ì‚¬ìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ê°œë°œì´ ì™„ë£Œë˜ëŠ” ì‹œì ì—
AssetERPì— ì¶”ê°€ë˜ëŠ” í˜•ì‹ìœ¼ë¡œ í”„ë¡œì íŠ¸ê°€ ê³„íšë˜ì—ˆìœ¼ë¯€ë¡œ ê³µì‹ì ì¸ ëª…ì¹­ì€ ê°–ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
ì´í•˜ <strong>Lucy</strong>ë¼ëŠ” ëª…ì¹­ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
<p>â€» ë³¸ ë¬¸ì„œëŠ” 2024.12ì— ì‘ì„± ë¨</p>
<h3>1.2 í”„ë¡œì íŠ¸ì´ ê¸°ê°„ê³¼ íˆ¬ì…ì¸ì›</h3>
<p>ê¸°ê°„ : 2024.3.1 ~ 2024.12.31
ì„¤ê³„ : ì²œì˜ì„ë¶€ì¥(1ì¸)
ê°œë°œ : ê¹€ë„ì˜ë¶€ì¥(1ì¸)</p>
<img src="https://upload.wikimedia.org/wikipedia/commons/f/f6/Ho_Chi_Minh_City_Skyline_%28night%29.jpg" alt="ë„ì‹œì•¼ê²½"> 
<h3>1.3 Lucyì˜ ëª©í‘œ</h3>
<p>Lucyì˜ ëª©í‘œëŠ” Restfulë°©ì‹ìœ¼ë¡œ ì¦ê¶Œì‚¬ê°€ ì œê³µí•˜ëŠ” OpenAPIë¥¼ ì´ìš©í•˜ì—¬ ìš´ìš©ì‚¬ê°€ AssetERPë¥¼ í†µí•´ì„œ ì£¼ë¬¸ì„ ë„£ê³ 
ì²´ê²°ì´ ë˜ë©´ í†µë³´ë¥¼ ë°›ëŠ” ê²ƒì„ 1ì°¨ëª©í‘œë¡œ í•©ë‹ˆë‹¤.
ìµœì¢…ì ìœ¼ë¡œëŠ” ìš´ìš©ì‚¬ì˜ ì •í•´ì§„ ìê¸ˆê³¼ ë¶„ë°°ê³„íšì— ë”°ë¼ì„œ ì—¬ëŸ¬ ì¦ê¶Œì‚¬ì— ì£¼ë¬¸ì„ ë„£ê³  ì²´ê²°í†µë³´ë¥¼ ë°›ëŠ” ê²ƒì…ë‹ˆë‹¤.</p>
<h3>1.4 Lucyì˜ ê°œë°œê³¼ì •</h3>
<p>LucyëŠ” 2ê°œì˜ ì¦ê¶Œì‚¬ ì¦‰ í•œêµ­íˆ¬ìì¦ê¶Œê³¼ LSì¦ê¶Œ(ì´ë² ìŠ¤íŠ¸íˆ¬ìì¦ê¶Œ)ì„ ëŒ€ìƒìœ¼ë¡œ open apië¥¼ í†µí•´ì„œ ì£¼ë¬¸ì„ ë„£ê³  ì²´ê²°í†µë³´ë¥¼ ë°›ëŠ” ê²ƒì„
ì‹œë„í•˜ì˜€ëŠ”ë°, ê¸°íƒ€ ì¦ê¶Œì‚¬ë“¤ì€ Restfulë°©ì‹ìœ¼ë¡œ OpenAPIë¥¼ ì œê³µí•˜ê³  ìˆì§€ ì•Šê¸° ë•Œë¬¸ì´ì—ˆìŠµë‹ˆë‹¤.(2024.3 ê¸°ì¤€ ì°¸ì¡°-<a href="https://www.bluestones.biz/cms/pages?action=view&amp;page=/HomePage/stock/stock_products.md">ì¦ê¶Œì‚¬ë³„ openapiì œê³µí˜„í™©</a>)
2ê°œì˜ ì¦ê¶Œì‚¬ë¥¼ ì œì™¸í•˜ë©´ ëŒ€ë¶€ë¶„ì˜ ì¦ê¶Œì‚¬ë“¤ì´ ìœˆë„ìš° ê¸°ë°˜ì˜ OCX,DLL,COMë“±ì˜ ê¸°ìˆ ë¡œ open apië¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
ìœˆë„ìš°ê¸°ë°˜ì˜ ê¸°ìˆ ì€ ì›¹ìœ¼ë¡œ êµ¬í˜„í•˜ê¸° ìš©ì´í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ Lucyì˜ ê°œë°œì—ëŠ” ì ìš©ì„ ê³ ë ¤í•˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
<p>Restful OpenAPIë¥¼ ì œê³µí•˜ëŠ” 2ê°œì˜ ì¦ê¶Œì‚¬ apiëŠ” ë²•ì¸ê³¼ ê°œì¸ì„ êµ¬ë³„í•˜ì—¬ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤. ê·¸ëŸ¬ë‚˜ ê°œë°œê³¼ì •ì—ì„œ ë²•ì¸ìœ¼ë¡œ
ê°œë°œí•˜ê¸°ê°€ ìš©ì´í•˜ì§€ ì•Šì•„ì„œ (ë²•ì¸ì€ openapi í‚¤ë°œê¸‰ì´ ê°œì¸ë³´ë‹¤ ì—„ê²©í•¨, ë²•ì¸ìœ¼ë¡œ ê°œë°œì‹œ ì‹¤ì œì ì¸ ê±°ë˜ë¥¼ í•˜ê¸° ì‰½ì§€ ì•ŠìŒ )
ê°œë°œì ê°œì¸ìœ¼ë¡œ open api keyë¥¼ ë°œê¸‰ë°›ì•„ì„œ ê°œë°œì„ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.</p>
<p>ì°¸ê³ ë¡œ ë‘ ê°œì˜ ì¦ê¶Œì‚¬ ëª¨ë‘ ëª¨ì˜ê³„ì¢Œë¥¼ ì œê³µí•˜ì§€ë§Œ ì‹¤ì œë¡œ ê°œë°œì„ ì§„í–‰í•˜ë‹¤ë³´ë©´ ëª¨ì˜ê³„ì¢Œë¡œ ê°œë°œì„ ì§„í–‰í•˜ëŠ” ê²ƒì€ ì—¬ëŸ¬ê°€ì§€ ì œì•½ì¡°ê±´ì´ ìˆìŠµë‹ˆë‹¤
ê·¸ë˜ì„œ ê°œë°œì§„ë„ìƒ ëª¨ì˜ê³„ì¢Œë¡œ ì§„í–‰í•˜ê¸°ê°€ ì–´ë ¤ì› ìŠµë‹ˆë‹¤.</p>
<h3>1.5 ëª©í‘œ ë¯¸ë‹¬ì˜ ì‚¬ìœ </h3>
<p>Lucyì˜ êµ¬í˜„ ë‚´ìš©ì´ ì‘ì§€ëŠ” ì•Šì§€ë§Œ ê·¸ë˜ë„ ì‹¤ì§ˆì ìœ¼ë¡œ AssetERPì— ì ìš©í•  ìˆ˜ ì—†ì–´ì„œ ë§Œì¡±í•  ìˆ˜ ìˆëŠ” ìƒí™©ì— ì´ë¥´ì§€ ëª»í•œ ê²ƒì—ëŠ”
ì•„ë˜ì™€ ê°™ì€ ì‚¬ìœ ê°€ ìˆìŠµë‹ˆë‹¤</p>
<ol>
<li>Restful APIë°©ì‹ì˜ OpenAPIë¥¼ ì œê³µí•˜ëŠ” ì¦ê¶Œì‚¬ê°€ 2ê°œë°–ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
<li>ëª…í™•í•œ ì„¤ê³„ë¥¼ ê°–ê³  ìˆì§€ ì•Šë‹¤. ì¦‰ ìš´ìš©ì‚¬ê°€ ì‹¤ì œì ìœ¼ë¡œ OMSë¥¼ ì–´ë–¤ ì‹ìœ¼ë¡œ ì›í•˜ëŠ”ì§€ êµ¬ì²´ì ì¸ ìš”êµ¬ì‚¬í•­ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.</li>
<li>ë²•ì¸ì„ ëŒ€ìƒìœ¼ë¡œ ê°œë°œì„ í•´ì•¼í–ˆì§€ë§Œ ìƒê¸° ê¸°ìˆ í•œ ë°”ì™€ ê°™ì´ ë²•ì¸ìœ¼ë¡œ ê°œë°œí•˜ê¸° ì‰½ì§€ ì•Šì€ í™˜ê²½ì´ì—ˆìŠµë‹ˆë‹¤.</li>
</ol>
<h3>1.6 ê°œë°œ ë‚´ìš© (ì£¼ìš”ê¸°ëŠ¥)</h3>
<p>ì´ˆê¸° ìƒì •í–ˆë˜ ëª©í‘œì— ë¯¸ë‹¬í•˜ì˜€ì§€ë§Œ LucyëŠ” ì•„ë˜ì™€ ê°™ì€ ê¸°ëŠ¥ì„ ê°–ë„ë¡ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.
ê°œì¸ì´ í•œêµ­íˆ¬ìì¦ê¶Œê³¼ LSì¦ê¶Œì— ê³„ì¢Œë¥¼ ê°–ê³  ìˆìœ¼ë©° Open API í‚¤ë¥¼ ë°œê¸‰ë°›ì€ ìƒíƒœì—¬ì•¼ í•©ë‹ˆë‹¤</p>
<h4>ì£¼ìš”ê¸°ëŠ¥</h4>
<ol>
<li>ë¡œê·¸ì¸</li>
<li>ê³„ì¢Œ ë‚´ìš©ì„ ì¡°íšŒ</li>
<li>ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸</li>
<li>ì²´ê²°í†µë³´ ë° ì²´ê²°ì •ë³´ ì¡°íšŒ</li>
<li>ì£¼ì‹ì¢…ëª© ì¡°íšŒ</li>
<li>ê³µëª¨ì£¼ ì¼ì • ë° ë‚´ìš© ì¡°íšŒ</li>
<li>ì‚¬ìš©ìì •ë³´ ê´€ë¦¬</li>
</ol>
<h2>2. ê¸°ìˆ ìŠ¤íƒ(Tech Stack)</h2>
<h3>2.1 ê¸°ìˆ  ê°œìš”</h3>
<p>LucyëŠ” íŒŒì´ì¬ì–¸ì–´(version 3.12.2)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°œë°œë˜ì—ˆìœ¼ë©° í˜„ì¬ í•œêµ­í€ë“œì„œë¹„ìŠ¤(ì£¼)ì˜ AssetERPì˜  ë©”ì¸ ê°œë°œ ì–¸ì–´ì¸ java ê¸°ë°˜ì˜ ê¸°ìˆ ê³¼ëŠ” ë‹¤ë¥¸
í™˜ê²½ê³¼ ê°œë°œë°©ë²•ì„ ê°€ì§€ê³  ê°œë°œë˜ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë˜ì„œ AssertERPì˜ ê°œë°œìì˜ ì´í•´ë¥¼ ë†’ì´ê¸°ìœ„í•´ì„œ javaê¸°ìˆ ìŠ¤íƒê³¼ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ê¸°ìˆ í•©ë‹ˆë‹¤.
ê´„í˜¸ ì•ˆì˜ ê¸°ìˆ ì€ Lucyì— ì‚¬ìš©ëœ ê¸°ìˆ ê³¼ ëŒ€ì‘í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>
<p>LucyëŠ” ì•„ë˜ì™€ ê°™ì€ ê¸°ìˆ ì  íŠ¹ì§•ì„ ê°–ê³  ìˆìŠµë‹ˆë‹¤.</p>
<ol>
<li>ë°±ì—”ë“œ(Backend) ì™€ í”„ëŸ°íŠ¸ì—”ë“œ(Frontend)ë¥¼ ëª¨ë‘ ê°–ê³  ìˆìŒ</li>
<li><a href="https://fastapi.tiangolo.com/ko/">FastAPI</a>ë¡œ ê°œë°œë¨</li>
<li><a href="https://www.mongodb.com/ko-kr">MongoDB</a>ë¥¼ <a href="https://beanie-odm.dev/">Beanie</a> <a href="https://gmlwjd9405.github.io/2019/02/01/orm.html">ORM</a> ìœ¼ë¡œ ì‚¬ìš©</li>
<li>ìì²´ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ê°–ê³  ìˆìŒ
<ol>
<li><a href="https://www.judal.co.kr/">ì£¼ë‹¬</a> ì‚¬ì´íŠ¸ scrapping</li>
<li><a href="https://www.38.co.kr/">38ì»¤ë®¤ë‹ˆì¼€ì´ì…˜</a> ì‚¬ì´íŠ¸ scrapping IPOì •ë³´ ì·¨ë“</li>
</ol>
</li>
<li><a href="https://ko.wikipedia.org/wiki/JSON_%EC%9B%B9_%ED%86%A0%ED%81%B0">JWT</a> ì¸ì¦</li>
<li>ì›¹ì†Œì¼“ : ì²´ê²°ì •ë³´ë¥¼ ì„œë²„ë¡œë¶€í„° ìˆ˜ì‹ í•˜ê¸° ìœ„í•˜ì—¬ ì‚¬ìš©ë¨</li>
<li>ìì²´ì ì¸ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ê°–ê³  ìˆìŠ´</li>
</ol>
<h3>2.1 ë°±ì—”ë“œ ê¸°ìˆ  (Backend)</h3>
<ul>
<li>
<p>í”„ë¡œê·¸ë˜ë° ì–¸ì–´ : python 3.12 (java 1.8)</p>
</li>
<li>
<p>ì›¹í”„ë ˆì„ì›Œí¬ : FastAPI (GWT)</p>
<ul>
<li>pythonì€ ì›¹í”„ë ˆì„ì›Œí¬ëŠ” Django,Flask,FastAPI 3ê°€ì§€ê°€ ì£¼ìš” í”„ë ˆì„ì›Œí¬ì´ë©° FastAPIê°€ ê°€ì¥ ìµœê·¼ì— ê°œë°œë˜ì–´ì¡ŒìŠµë‹ˆë‹¤.</li>
<li>FastAPIê°€ ë¹„ë™ê¸°ë¥¼ ì§€ì›í•œë‹¤ëŠ” ì ê³¼ ê°€ì¥ ë¹ ë¥´ë‹¤ëŠ” ì˜ê²¬ë•Œë¬¸ì— ì„ ì •í•˜ì˜€ìŠµë‹ˆë‹¤.(ì°¸ê³ : <a href="https://www.hanbit.co.kr/channel/category/category_view.html?cms_code=CMS5997817104">python ì›¹í”„ë ˆì„ì›Œí¬ë¹„êµ</a>)</li>
</ul>
</li>
<li>
<p>ì›¹ì„œë²„ : <a href="https://www.uvicorn.org/">Uvicorn</a> (Tomcat)</p>
<ul>
<li>í†µì¹­ <strong>ASGI</strong>(Asynchronous Server Gateway Interface)ì„œë²„ë¼ê³  í•˜ë©° fastAPIë¥¼ ëŒë¦¬ê¸° ìœ„í•´ì„œëŠ” í•„ìˆ˜ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
</ul>
</li>
<li>
<p>DBMS : MongoDB(PostgreSQL)</p>
<ul>
<li>no-sql databaseë¡œ R-DBMSì™€ ë¹„êµí•˜ì—¬ ë¹„ì •í˜•ë°ì´í„°ë¥¼ ë‹¤ë£¨ê¸° ìš©ì´í•©ë‹ˆë‹¤.</li>
<li>ì£¼ì‹ì •ë³´ë°ì´í„° ì¦‰ ì¦ê¶Œì‚¬ê°€ ì œê³µí•˜ëŠ” ë°ì´í„°ê°€ ë³€ê²½ë˜ê¸° ì‰½ë‹¤ëŠ” ì ì—ì„œ ì„ ì •í•˜ì˜€ìŠµë‹ˆë‹¤.</li>
</ul>
</li>
<li>
<p>í…œí”Œë¦¿ ì—”ì§„ : jinja2(java ëŒ€ì‘ ê¸°ìˆ  ì—†ìŠ´) ì„œë²„ìª½ template ì—”ì§„ìœ¼ë¡œ python ê³„ì—´ì˜ ì›¹ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ë„ë¦¬ ì‚¬ìš©ë˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p>ë¯¸ë“¤ì›¨ì–´ : JWTë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¸ì¦ì²˜ë¦¬, StaticíŒŒì¼ë“¤ ì²˜ë¦¬</p>
</li>
</ul>
<h3>2.2 í”„ëŸ°íŠ¸ì—”íŠ¸ ê¸°ìˆ  (Frontend)</h3>
<ul>
<li>CSSí”„ë ˆì„ì›Œí¬ : <a href="https://getbootstrap.com/">bootstrap5</a> ( GXT )</li>
<li>í…œí”Œë¦¿ ì—”ì§„ : <a href="https://handlebarsjs.com/">handlebar</a> (ì—†ìŒ)</li>
<li>DOM handling : jquery (ì—†ìŒ)</li>
<li>javascriptìì²´ì˜ fetch í•¨ìˆ˜ : API í†µì‹ </li>
</ul>
<h3>2.3 FastAPI ì›¹í”„ë ˆì„ì›Œí¬</h3>
<ul>
<li>LucyëŠ” FastAPI ì›¹í”„ë ˆì„ì›Œí¬ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìì²´ì ì¸ í”„ë ˆì„ì›Œí¬(ê°œë°œë°©ë²•)ì„ êµ¬ì¶•í–ˆìŠµë‹ˆë‹¤.</li>
</ul>
<p><img src="./images/lucy_system.png" alt="ì‹œìŠ¤í…œêµ¬ì„±ë„" /></p>
<ul>
<li>ìŠ¤ì¼€ì¤„ëŸ¬ì—ì„œ êµ¬ë™ë˜ëŠ” ëª¨ë“ˆì„ ì œì™¸í•œ ëª¨ë“  ëª¨ë“ˆì´ asyncë¡œ ë™ì‘í•©ë‹ˆë‹¤.</li>
<li>LucyëŠ” ê¸°ë³¸ì ìœ¼ë¡œ MVCëª¨ë¸ì„ ë”°ë¼ì„œ ì„¤ê³„ë˜ì—ˆìœ¼ë©° RequestëŠ” Routerì—ì„œ í•´ì„ë˜ì–´
Service ëª¨ë“ˆì—ì„œ í•„ìš”í•œ ì •ë³´ë¥¼ íšë“í•œ í›„ ì‚¬ìš©ìì—ê²Œ ì „ì†¡í•©ë‹ˆë‹¤. ì´ë•Œ ì •ë³´ì˜ ë‹¨ìœ„ëŠ” modelë‹¨ìœ„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.</li>
</ul>
<h4>2.3.1 ê° ëª¨ë“ˆì˜ ì„¤ëª…</h4>
<ol>
<li>
<p>Middleware</p>
<ol>
<li>ì‹¤ì œ êµ¬í˜„ì²´ : jwtmiddleware.py</li>
<li>ê¸°ëŠ¥
<ul>
<li>requestì˜ headerë¥¼ í•´ì„í•˜ì—¬ ì¸ì¦í•©ë‹ˆë‹¤.</li>
<li>Lucyì—ì„œëŠ” ê¶Œí•œì— ë”°ë¥¸ ê¸°ëŠ¥ ì œí•œì€ ì—†ìŠµë‹ˆë‹¤.</li>
</ul>
</li>
</ol>
</li>
<li>
<p>Router ëª¨ë“ˆë“¤</p>
<ul>
<li>clientë¡œë¶€í„° ìš”ì²­ë°›ëŠ” ì„œë¹„ìŠ¤(methodì™€ parameter)ë¥¼ ë°›ì•„ì„œ ê° serviceëª¨ë“ˆì„ í˜¸ì¶œí•˜ì—¬ ì‘ë‹µ(json)ì„ clientì— ë¦¬í„´í•´ ì¤Œ</li>
</ul>
</li>
<li>
<p>Db Service ëª¨ë“ˆë“¤</p>
<ul>
<li>Databaseì™€ì˜ ë™ì‘ì„ ë‹´ë‹¹í•˜ë©´ ê° í…Œì´ë¸”ë‹¹ 1ê°œì”©ì˜ Serviceë¥¼ ê°–ê³  ìˆìŒ.</li>
</ul>
</li>
<li>
<p>Api Service ëª¨ë“ˆ</p>
<ul>
<li>ì¦ê¶Œì‚¬(KIS,LS)ì˜ open apië¥¼ í˜¸ì¶œí•¨</li>
</ul>
</li>
<li>
<p>Websocket ëª¨ë“ˆë“¤</p>
<ul>
<li>ì¦ê¶Œì‚¬ì™€ì˜ websocketì—°ê²° ë° clientì™€ì˜ websocketì—°ê²°ì„ ë‹´ë‹¹</li>
</ul>
</li>
<li>
<p>Scheduler</p>
<ul>
<li>judal scrappingë° ì»¤ë®¤ë‹ˆì¼€ì´ì…˜38ì‚¬ì´íŠ¸ ìŠ¤í¬ë˜í•‘ì„ ê´€ë¦¬</li>
</ul>
</li>
</ol>
<h4>2.3.2 ë””ë ‰í† ë¦¬ êµ¬ì¡°</h4>
<ul>
<li>LucyëŠ” backendì™€ frontendë¥¼ ëª¨ë‘ ê°€ì§€ê³  ìˆìŠµë‹ˆë‹¤.</li>
<li>backendëŠ” backendí´ë”ì—, frontendëŠ” frontend í´ë” í•˜ìœ„ì— ì¡´ì¬í•©ë‹ˆë‹¤.</li>
<li>backendì˜ íŠ¹ì§•
<ul>
<li>backendëŠ” Restful api ì„œë²„ì™€ ê°™ì´ ë™ì‘í•©ë‹ˆë‹¤</li>
<li>page urlì— ëŒ€í•´ì„œ jinja2ë¥¼ ì´ìš©í•˜ì—¬ í˜ì´ì§€ë¥¼ renderingí•´ì„œ htmlì„ ë³´ë‚´ì¤ë‹ˆë‹¤.</li>
<li>backend ë””ë ‰í† ë¦¬ êµ¬ì¡°</li>
</ul>
</li>
</ul>
<pre><code class="language-text">|-- backend
|   |-- app
|   |   |-- api
|   |   |   `-- v1
|   |   |       `-- endpoints
|   |   |-- background
|   |   |   `-- jobs
|   |   |-- core
|   |   |   `-- exception
|   |   |-- domains
|   |   |   |-- ipo
|   |   |   |-- judal
|   |   |   |-- stc
|   |   |   |   |-- kis
|   |   |   |   |   `-- model
|   |   |   |   `-- ls
|   |   |   |       `-- model
|   |   |   |-- system
|   |   |   `-- user
|   |   |-- managers
|   |   `-- utils
</code></pre>
<ul>
<li>
<p>backend ê° í´ë”ì˜ ì„¤ëª…</p>
<ul>
<li>app/api/v1/endposts : routerë“¤ ì¦‰ Restful api ì„œë²„ì™€ ê°™ì´ url,methodì— ëŒ€í•œ ì„œë¹„ìŠ¤ì œê³µ</li>
<li>app/api/background : ìŠ¤ì¼€ì¤„ëŸ¬ê°€ í˜¸ì¶œí•˜ëŠ” í”„ë¡œê·¸ë¨ë“¤</li>
<li>app/api/core : middleware, logger, exceptionë“±</li>
<li>app/api/domain : routerê°€ ì‚¬ìš©í•˜ëŠ” service ë° model ë“¤ (DTO)</li>
<li>app/api/managers : websocket managerë“¤</li>
</ul>
</li>
<li>
<p>frontendì˜ íŠ¹ì§•</p>
<ul>
<li>template ì—”ì§„ìœ¼ë¡œ handlebarë¥¼ ì‚¬ìš©</li>
<li>javascript ìì²´ì˜ fetchí•¨ìˆ˜ë¥¼ ì‚¬ìš©</li>
<li>bootstrap5 css libraryì˜ ì‚¬ìš©</li>
<li>jquery ì‚¬ìš©</li>
</ul>
</li>
<li>
<p>frontend ë””ë ‰í† ë¦¬ êµ¬ì¡°</p>
</li>
</ul>
<pre><code class="language-text">`-- frontend
    |-- public
    |   |-- css
    |   |-- images
    |   `-- js
    |       `-- kis
    `-- views
        |-- common
        |-- handlebar
        |   |-- kis
        |   |-- ls
        |   `-- mystock
        `-- template
            |-- config
            |-- danta
            |-- ipo
            |-- judal
            |-- kis
            |-- ls
            |-- mystock
            |-- scheduler
            `-- user
</code></pre>
<ul>
<li>
<p>frontend ê° í´ë”ì˜ ì„¤ëª…</p>
<ul>
<li>public : static íŒŒì¼ë“¤ ì¦‰ javascript, css, image ë“¤ ë³´ê´€</li>
<li>views/common : nav.htmlë“± ê³µí†µ í™”ë©´</li>
<li>handlebar : clientì—ì„œ dataì™€ í•¨ê»˜ rendering ë˜ì–´ì•¼í•  handlebar scriptë“¤</li>
<li>templates : server sideì—ì„œ renderingë˜ì–´ì•¼ í•  í˜ì´ì§€ë“¤</li>
</ul>
</li>
<li>
<p>ê¸°íƒ€ í´ë”ë“¤</p>
<ul>
<li>doc : ê´€ë ¨ ë¬¸ì„œë“¤</li>
<li>data: ì‚°ì¶œë˜ëŠ” dataë“¤</li>
<li>data/judal : judalì‚¬ì´íŠ¸ì—ì„œ scrappingí•œ íŒŒì¼ë“¤ì„ ë‚ ì§œë³„ë¡œ ë³´ê´€</li>
</ul>
</li>
</ul>
<h2>3. í”„ë¡œì íŠ¸ ìƒì„¸</h2>
<h3>3.1 í”„ë¡œê·¸ë¨ì˜ ì‹œì‘</h3>
<ul>
<li>LucyëŠ” ê¸°ë³¸ì ìœ¼ë¡œ fastAPIë¡œ ì‘ì„±ëœ web ì–´í”Œë¦¬ì¼€ì´ì…˜ì…ë‹ˆë‹¤.</li>
<li>/backend/main.py ì—ì„œ ì‹œì‘ë©ë‹ˆë‹¤.</li>
<li>tomcatì— í•´ë‹¹í•˜ëŠ” ì—­í™œì„ í•˜ëŠ” <a href="https://www.uvicorn.org/">uvicorn</a>ì— ì˜í•´ì„œ êµ¬ë™ë©ë‹ˆë‹¤.</li>
<li>main.pyëŠ” ë‹¤ìŒê³¼ ê°™ì€ ìˆœì„œë¡œ ìˆ˜í–‰ë©ë‹ˆë‹¤.</li>
</ul>
<pre><code class="language-text">  1. ë¯¸ë“¤ì›¨ì–´ì˜ ì„¤ì •(clientì¸ì¦ìˆ˜í–‰)
  2. router ì„¤ì • : ì„œë¹„ìŠ¤ endpoints ì„¤ì •
  3. web server start/end event í•¸ë“¤ëŸ¬ì„¤ì •
     - startì‹œ mongo dbì˜ ì—°ê²°
     - end ì‹œ mongo dbì˜ close
  4. static_files ì„¤ì • : js, image, css í´ë” ì„¤ì •
  5. exception handler ì„¤ì •
</code></pre>
<h3>3.2 config ë° JWTì¸ì¦</h3>
<ul>
<li>cleintì™€ì˜ ì¸ì¦ì€ JWT(Json Web Token)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤</li>
<li>/login routerì—ì„œ jwt tokenì„ ë°œê¸‰í•©ë‹ˆë‹¤.</li>
<li>ìœ íš¨ì‹œê°„ì€ configì—ì„œ ì„¤ì •ëœ ê°’ì— ì˜í•´ì„œ ì œí•œë©ë‹ˆë‹¤</li>
<li>configëŠ” .env_{profile}ì— ì €ì¥ëœ ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
<li>profileì€ í™˜ê²½ë³€ìˆ˜ì— LUCY_MODEì— ì„¤ì •ëœ ê°’ì…ë‹ˆë‹¤.
ì¦‰ set LUCY_MODE=realì´ë©´ .env_real íŒŒì¼ì„ ì½ì–´ì„œ ê° ë³€ìˆ˜ì˜ ê°’ì„ ì„¤ì •í•©ë‹ˆë‹¤.</li>
<li>configëŠ” í”„ë¡œì íŠ¸ ì „ë°˜ì— ê±¸ì³ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.</li>
<li>git repositoryì— .env_{profile}ì€ ë°°í¬ë˜ì–´ì„œëŠ” ì•ˆë˜ë©°, .gitignoreì— ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<pre><code class="language-python">class Config:
    def __init__(self):
        self.PROFILE_NAME = os.getenv('LUCY_MODE', 'local')
        load_dotenv(dotenv_path=f'.env.{self.PROFILE_NAME}')

        ...
        self.DEFAULT_USER_ID = os.getenv('DEFAULT_USER_ID', 'kdy987')
config = Config()
</code></pre>
<h3>3.3 ê° ì¦ê¶Œì‚¬ì™€ì˜ ì¸ì¦</h3>
<ul>
<li>
<p>RESTful apië¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” <a href="https://apiportal.koreainvestment.com/intro">KIS</a>, <a href="https://openapi.ls-sec.co.kr/intro">LS</a> ê° ì¦ê¶Œì‚¬ì— 1)<strong>ê³„ì¢Œê°€ ì¡´ì¬</strong>í•´ì•¼ í•˜ê³  2)<strong>ì‚¬ìš©ì ë“±ë¡</strong>ì„ í•´ì•¼í•˜ê³  3)<strong>Keyë¥¼ ë°œê¸‰</strong>ë°›ì•„ì•¼ í•©ë‹ˆë‹¤</p>
</li>
<li>
<p>KIS ë° LS ì¦ê¶Œì‚¬ëŠ” ê°œì¸ ì‚¬ìš©ìì—ê²ŒëŠ” 24ì‹œê°„, ë²•ì¸ ì‚¬ìš©ìì—ê²ŒëŠ” 1ë‹¬ì˜ ìœ íš¨ê¸°ê°„ì„ ê°–ëŠ” í‚¤ë¥¼ ë°œê¸‰í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ë‘ ì¦ê¶Œì‚¬ ëª¨ë‘ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ ì¸ì¦ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤.</p>
<pre><code class="language-text">  1. APP_KEYì™€ APP_SECRET_KEY 2ê°œì˜ í‚¤ë¥¼ ë°œê¸‰í•¨.
  2. ë‘ ê°œì˜ í‚¤ë¥¼ headerì— ë„£ì–´ì„œ tokenë°œê¸‰ ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•˜ë©´ access tokenì„ ë°œê¸‰í•´ ì¤Œ
  3. ì´í›„ í† í°ì˜ ìœ íš¨ì‹œê°„ ë‚´ì—ì„œ tokenì„ headerì˜ authorizationì— ë„£ê³  ê¸°íƒ€ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œ
</code></pre>
</li>
<li>
<p>Lucyì—ì„œëŠ” mongo DBì— APP_KEYì™€ APP_SECRET_KEYë¥¼ ì €ì¥í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ë°œê¸‰ë°›ì€ ACCESS_TOKEN ì—­ì‹œ mongo dbì— ì €ì¥í•˜ì—¬ ì‚¬ìš©í•˜ë©° ë§Œë£Œ ì‹œê°„ ì´ˆê³¼ì‹œ ë‹¤ì‹œ ë°œê¸‰ë°›ê³  ë‹¤ì‹œ ì €ì¥í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤.</p>
</li>
</ul>
<h3>3.4 KIS ì¦ê¶Œ api</h3>
<ul>
<li>ë¶€ëª¨ í´ë˜ìŠ¤ StockApië¡œ ë¶€í„° ìƒì†ë°›ìŠµë‹ˆë‹¤. ì¦‰ StockApiì˜ ìì‹ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.</li>
</ul>
<pre><code class="language-mermaid">classDiagram
    StockApi &lt;|-- KisStockApi
    StockApi &lt;|-- LsStockApi
    StockApi : +user_id
    StockApi : +acctno
    StockApi : +user_service
    StockApi : initialize()
    StockApi : get_access_token_time()
    LsStockApi : send_request()
    KisStockApi : send_request()
</code></pre>
<ul>
<li>KIS ì¦ê¶Œê³¼ì˜ apië¥¼ ìœ„í•´ì„œ KisStockApi class ì‘ì„±í•˜ì—¬ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
<li>íŒŒì¼ëª… : kis_stock_api.py</li>
<li><a href="https://apiportal.koreainvestment.com/apiservice/oauth2#L_5c87ba63-740a-4166-93ac-803510bb9c02">KISì—ì„œ ì œê³µí•˜ëŠ” RestfulAPI</a>ì˜ ê° ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</li>
<li>ë§ì€ methodê°€ ìˆì§€ë§Œ ë™ì¼í•œ êµ¬ì¡°ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤.</li>
<li>KisStockApiì˜ ì£¼ìš” ë©”ì†Œë“œ
<ul>
<li>set_access_token_from_kis : ë™ê¸°(sync)ë°©ì‹ìœ¼ë¡œ ACCESS_TOKENì„ ë°œê¸‰ë°›ê³  ëª½ê³  DBì— ì €ì¥í•¨</li>
<li>send_request : ê¸°íƒ€ í•¨ìˆ˜(class method)ì—ì„œ ì´ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ KISì— ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•¨.
<ul>
<li>KISëŠ” GET, POST 2ê°œì˜ method(http)ë§Œì„ ì œê³µí•¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<pre><code class="language-python">    async def send_request(self, title, method, url, headers, params=None, data=None):
        try:
            async with aiohttp.ClientSession() as session:
                if method == 'GET':
                    async with session.get(url, headers=headers, params=params) as response:
                        response.raise_for_status()
                        return await response.json()
                elif method == 'POST':
                    async with session.post(url, headers=headers, data=data) as response:
                        response.raise_for_status()
                        return await response.json()
        except aiohttp.ClientError as e:
            logger.error(f&quot;HTTP ì˜¤ë¥˜ ({title}): {e}&quot;)
            raise KisApiException(status_code=500, detail=f&quot;HTTP ì˜¤ë¥˜ ({title}): {e}&quot;)                    
        except json.JSONDecodeError as e:
            logger.error(f&quot;Response is not in JSON format.{title}&quot;)
            raise InvalidResponseException(f&quot;ì‘ë‹µ ë‚´ìš©ì´ JSONí˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤ ({title})&quot;)
</code></pre>
<ul>
<li>ê° ì„œë¹„ìŠ¤ëŠ” KISì—ì„œ ì œê³µí•˜ëŠ” ë¬¸ì„œì— ë”°ë¥¸ ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•˜ê¸° ìœ„í•´ headerì™€ paramsë˜ëŠ” dataë¥¼ ì„¤ì •í•œ í›„ send_requestë¥¼  í˜¸ì¸¨í•˜ëŠ” ê²ƒìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.</li>
<li>ì•„ë˜ëŠ” stk_codeë¥¼ ì¸ìë¡œ í•˜ëŠ” <a href="https://apiportal.koreainvestment.com/apiservice/apiservice-domestic-stock-quotations2#L_07802512-4f49-4486-91b4-1050b6f5dc9d">í˜„ì¬ê°€ë¥¼ êµ¬í•˜ëŠ”  í•¨ìˆ˜</a>ì˜ ì˜ˆ ì…ë‹ˆë‹¤.</li>
</ul>
<pre><code class="language-python">    async def current_cost(self, stk_code:str) -&gt; InquirePrice_Response:
        ''' í˜„ì¬ê°€ ì¡°íšŒ '''
        url = self.BASE_URL +  '/uapi/domestic-stock/v1/quotations/inquire-price' 
        headers = {&quot;Content-Type&quot;:&quot;application/json&quot;, 
                &quot;authorization&quot;: f&quot;Bearer {self.ACCESS_TOKEN}&quot;,
                &quot;appKey&quot;:self.APP_KEY,
                &quot;appSecret&quot;:self.APP_SECRET,
                &quot;tr_id&quot;:&quot;FHKST01010100&quot;}
        params = {
            &quot;fid_cond_mrkt_div_code&quot;:&quot;J&quot;,
            &quot;fid_input_iscd&quot;:stk_code,
        }
        json_response = await self.send_request('í˜„ì¬ê°€ ì¡°íšŒ', 'GET', url, headers, params=params)
        self.check_access_token(json_response)
        logger.debug(f&quot;í˜„ì¬ê°€: {stk_code} : {json_response['output']['stck_prpr']}&quot;)
        try:
            return InquirePrice_Response(**json_response)
        except ValidationError as e:
            raise HTTPException(status_code=500, detail=f&quot;ë°›ì€ json íŒŒì‹± ì˜¤ë¥˜: {e}&quot;)    
</code></pre>
<ul>
<li>
<p>ì‚¬ìš©ë°©ë²•</p>
<pre><code class="language-python">  kis_api = await StockApiManager().kis_api()
  cost = await kis_api.get_current_price(stk_code) 
</code></pre>
</li>
</ul>
<h3>3.5 LS ì¦ê¶Œ api</h3>
<ul>
<li>ë¶€ëª¨ í´ë˜ìŠ¤ StockApië¡œ ë¶€í„° ìƒì†ë°›ìŠµë‹ˆë‹¤. ì¦‰ StockApiì˜ ìì‹ í´ë˜ìŠ¤ì…ë‹ˆë‹¤.</li>
<li>LSì¦ê¶Œì˜ ì œê³µë˜ëŠ” APIë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ KISì™€ ìœ ì‚¬í•˜ê²Œ LsStockApi classê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
<li>KISì™€ ìœ ì‚¬í•œ ë°©ì‹ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
<li>íŒŒì¼ëª… : ls_stock_api.py</li>
<li><a href="https://openapi.ls-sec.co.kr/apiservice?group_id=ffd2def7-a118-40f7-a0ab-cd4c6a538a90&amp;api_id=33bd887a-6652-4209-88cd-5324bc7c5e36">LSì—ì„œ ì œê³µí•˜ëŠ” RestfulAPI</a>ì˜ ê° ì„œë¹„ìŠ¤ë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.</li>
<li>LSì—ì„œ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•œ ë‹¤ìˆ˜ì˜  methodê°€ ìˆì§€ë§Œ ë™ì¼í•œ êµ¬ì¡°ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤.</li>
<li>KisStockApiì˜ ì£¼ìš” ë©”ì†Œë“œ
<ul>
<li>set_access_token_from_kis : ë™ê¸°(sync)ë°©ì‹ìœ¼ë¡œ ACCESS_TOKENì„ ë°œê¸‰ë°›ê³  ëª½ê³  DBì— ì €ì¥í•¨</li>
<li>send_request : ê¸°íƒ€ í•¨ìˆ˜(class method)ì—ì„œ ì´ ë©”ì†Œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ KISì— ì„œë¹„ìŠ¤ë¥¼ ìš”ì²­í•¨.
<ul>
<li>KISëŠ” GET, POST 2ê°œì˜ method(http)ë§Œì„ ì œê³µí•¨</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>3.6 StockApiManager</h3>
<ul>
<li>Lucy(OMSì‹œìŠ¤í…œ)ì€ <strong>ì—¬ëŸ¬ëª…ì˜ ì‚¬ìš©ìê°€ ë‹¤ìˆ˜ì˜ ì¦ê¶Œì‚¬ì— ì£¼ë¬¸ì„ ë‚´ê³  ì²´ê²°í†µë³´ë¥¼ ë°›ëŠ”ë‹¤</strong> ëŠ” ì¡°ê±´ìœ¼ë¡œ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
<li>ì¦‰ ë‹¤ìˆ˜ì˜ ì‚¬ìš©ì, ê° ì‚¬ìš©ìë³„ë¡œ ë‹¤ìˆ˜ì˜ ì¦ê¶Œì‚¬ ê³„ì •ì„ ê´€ë¦¬í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.</li>
<li>ì´ëŸ° ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•˜ëŠ” ê²ƒì´ StockApiManagerì…ë‹ˆë‹¤.</li>
<li>ë¡œê·¸ì¸ ëœ ì‚¬ìš©ì ê³„ì •ì— ëŒ€í•´ì„œ ìš”ì²­ëœ ì„œë¹„ìŠ¤ê°€ KIS ì„œë¹„ìŠ¤ì¸ì§€, LS ì„œë¹„ìŠ¤ì¸ì§€ íŒë³„í•˜ì—¬ í•´ë‹¹í•˜ëŠ” StockApi ê°ì²´ë¥¼ ë°˜í™˜í•´ ì£¼ëŠ” ì—­í™œì„ í•©ë‹ˆë‹¤.</li>
<li>ì‹±ê¸€ë ˆí†¤ìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<h3>3.7 WebSocket Managers</h3>
<ul>
<li>KIS, LS ì¦ê¶Œì‚¬ë“¤ì€ ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ Websocketì„ ì‚¬ìš©í•˜ì—¬ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.</li>
<li>ì¦ê¶Œì‚¬ë“¤ì´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì—ëŠ” stkcodeì— ëŒ€í•œ ì‹¤ì‹œê°„ ê°€ê²©ì •ë³´ì™€ ì²´ê²°ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤.</li>
<li>ì‹¤ì‹œê°„ ê°€ê²©ì •ë³´ëŠ” Lucyì—ì„œ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë©° <strong>ì²´ê²°ì •ë³´ë§Œ</strong>ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
<li>Lucyì—ì„œëŠ” ì‚¬ìš©ìë³„ë¡œ ì¦ê¶Œì‚¬ì˜  websocketì˜ clientë¡œì„œ ë™ì‘í•˜ëŠ” <strong>StockWsManager</strong> ê°€ ìˆìŠµë‹ˆë‹¤.</li>
<li>Lucyì—ì„œëŠ” ì‚¬ìš©ì ì¦‰ ì ‘ì†í•œ Browserì˜ ì„œë²„ë¡œì„œ ë™ì‘í•˜ëŠ” <strong>ClientWsManager</strong> ê°€ ìˆìŠµë‹ˆë‹¤.</li>
<li>ë™ì‘ìˆœì„œ
<ol>
<li>ì‚¬ìš©ìê°€ ì›¹ì†Œì¼“ endpoint /wsì— ì ‘ì†</li>
<li>ClientWsManager ìƒì„±</li>
<li>ì¦ê¶Œì‚¬ë³„ StockWsManagerì˜ ìƒì„± ì´ë•Œ 2.ì—ì„œ ìƒì„±ëœ ClientWsManagerë¥¼ ì¸ìë¡œ ë„˜ê²¨ ì¤Œ</li>
<li>3.ì—ì„œ ìƒì„±ëœ StockWsManagerëŠ” ì¦ê¶Œì‚¬ë¡œë¶€í„° ê³„ì† ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ê¸°ë‹¤ë¦¬ê³  ìˆìŒ
(ì°¸ê³ : ì‹¤ì‹œê°„ ê°€ê²©ì •ë³´ëŠ” ê³„ì† ë°ì´í„°ê°€ ì „ì†¡ë˜ì–´ì ¸ ì˜¤ê³ , ì²´ê²°ì •ë³´ëŠ” ì²´ê²°ì‹œì—ë§Œ ë°ì´í„°ê°€ ì˜´)</li>
<li>ì¦ê¶Œì‚¬ì—ì„œ ì²´ê²°ì •ë³´ê°€ ì „ì†¡ë˜ì—ˆì„ ë•Œ StockWsManagerëŠ” ìì‹ ì—ê²Œ ì•Œë ¤ì§„ clientë¡œ ì²´ê²°ì •ë³´ë¥¼ ì „ì†¡í•¨.</li>
</ol>
</li>
</ul>
<h3>3.8 Core ëª¨ë“ˆë“¤</h3>
<ul>
<li>Lucy(fastApi ì„œë²„)ë¥¼ êµ¬ì„±í•˜ëŠ” ëª¨ë“ˆë“¤ ì…ë‹ˆë‹¤.</li>
<li>ëª©ë¡(backend/app/core)
<ol>
<li>config : .env<profile>ì—ì„œ ìƒìˆ˜ê°’ë“¤ì„ loadingí•´ì„œ ì‚¬ìš©ê°€ëŠ¥í•˜ê²Œ í•¨.</li>
<li>exception_handler : requestì— ëŒ€í•œ ì˜ˆì™¸ì²˜ë¦¬ë¥¼ ë‹´ë‹´í•¨.</li>
<li>jwtmiddleware : reqeustì— ëŒ€í•œ ì¸ì¦ì²˜ë¦¬ jwtë¥¼ ì‚¬ìš©</li>
<li>logger : ë¡œê¹…ì²˜ë¦¬ configì— ì„¤ì •ëœ íŒŒì¼ì— ë¡œê·¸ë¥¼ ë‚¨ê¸°ë©° profileì´ localì¼ ê²½ìš°ì—ëŠ” consoleì—ë„ ë¡œê·¸ë¥¼ ë‚¨ê¹€</li>
<li>mongodb : ëª½ê³ dbì˜ ì´ˆê¸°í™”ì™€ closeë‹´ë‹´</li>
<li>scheduelr : cron ì‘ì—…ì„ ê´€ë¦¬</li>
</ol>
</li>
</ul>
<h3>3.9 Scheduler</h3>
<ul>
<li>
<p>LucyëŠ” í˜„ì¬ 4ê°œì˜ ì‘ì—…ì„ cronë™ì‘ìœ¼ë¡œ ì‘ì—…í•˜ë„ë¡ í•˜ê³  ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>SchedulerJobService</strong> í´ë˜ìŠ¤ì™€  <strong>Scheduler</strong> í´ë˜ìŠ¤ê°€ ì£¼ìš” í´ë˜ìŠ¤ì…ë‹ˆë‹¤.</p>
</li>
<li>
<p>SchedulerëŠ” Apschedulerì˜ BackgroundSchedulerì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>SchedulerJobServiceê°€  Schedulerí´ë˜ìŠ¤ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©° ì‹¤ì œì ìœ¼ë¡œ jobë“±ë¡ë“±ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ë¹„ë™ê¸°ì‘ì—…ì´ ì•„ë‹™ë‹ˆë‹¤. ì¦‰ schedulerì— ì˜í•´ì„œ êµ¬ë™ë˜ëŠ” í”„ë¡œê·¸ë¨ì´ ë™ì‘í•˜ê³  ìˆëŠ” ë™ì•ˆì€ fastapiì˜ ì„œë¹„ìŠ¤ê°€ ì§€ì—°ë©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ì‘ì—…ëª©ë¡ì€ DBì—  ë³´ê´€ë˜ë©° Lucyê°€ ê¸°ë™ë  ë•Œ Schedulerì— ë“±ë¡ë©ë‹ˆë‹¤.</p>
</li>
<li>
<p>SchedulerJobServiceì˜  ê°€ì¥ ì£¼ìš”í•œ methodëŠ” <strong>register_system_jobs</strong>ì…ë‹ˆë‹¤.</p>
<ol>
<li>DBì—ì„œ ë“±ë¡ëœ job ë°ì´í„°ë¥¼ loadingí•œë‹¤.</li>
<li>jobmapperì™€ ì—°ê²°ëœ jobì„ Schedulerí´ë˜ìŠ¤ì— ë“±ë¡í•œë‹¤.</li>
</ol>
</li>
<li>
<p>ì‘ì—…ëª©ë¡</p>
</li>
</ul>
<ol>
<li>site38_work : ì»¤ë®¤ë‹ˆì¼€ì´ì…˜38 ìŠ¤í¬ë˜í•‘ (ê³µëª¨ì£¼ ì •ë³´)</li>
<li>holiday_godata : íœ´ì¼ì •ë³´</li>
<li>fil_ls_stk_info :  LS stk_info ì •ë³´ ì±„ìš°ê¸°</li>
<li>judal_fetch : <a href="https://www.judal.co.kr/">Judalì‚¬ì´íŠ¸</a>ì—ì„œ ì •ë³´ë¥¼ ìŠ¤í¬ë˜í•‘</li>
</ol>
<h3>4.0 frontend framework</h3>
<ul>
<li>
<p>template ì—”ì§„ìœ¼ë¡œ handlebarë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p>css frameworkë¡œ bootstrap5ë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p>jQueryë¥¼ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p>page ì´ë™ì˜ routerëŠ” home_routerì…ë‹ˆë‹¤</p>
</li>
<li>
<p>home_routerëŠ” ë‹¤ìŒê³¼ ê°™ì€ endpointë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤.
- /main: ë©”ì¸ í˜ì´ì§€
- /page: pathì— í•´ë‹¹í•˜ëŠ” í˜ì´ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ë‚¸ë‹¤.
- /template: pathì— í•´ë‹¹í•˜ëŠ” htmlì—ì„œ bodyì¶”ì¶œí•´ì„œ jinja2ì²˜ë¦¬í•œ JSONì„ ë¦¬í„´
- /login: ë¡œê·¸ì¸ í˜ì´ì§€
- /logout: ë¡œê·¸ì•„ì›ƒ í˜ì´ì§€
- /login: ë¡œê·¸ì¸ í”„ë¡œì„¸ìŠ¤</p>
</li>
<li>
<p>í˜ì´ì§€ rendering</p>
<ul>
<li>/page urlì— pathë¥¼ ì¸ìë¡œ ì£¼ì–´ì„œ pageë¥¼ ì´ë™í•˜ë‹ˆë‹¤.</li>
<li>ì˜ˆë¥¼ ë“¤ì–´ /page?path=/ipo/ipo-card ì¼ ê²½ìš° /frontend/views/templateí•˜ìœ„ì˜ í´ë” ipoì˜ ipo-card.html ì„ jinja2ë¡œ rendeingí•´ì„œ ë³´ì—¬ì£¼ê²Œ ë©ë‹ˆë‹¤.</li>
</ul>
<pre><code class="language-html">  &lt;li&gt;&lt;a class=&quot;nav-link&quot; href=&quot;/page?path=ipo/ipo-card&quot;&gt;ê³µëª¨ì£¼-ìƒì„¸&lt;/a&gt;&lt;/li&gt;  
</code></pre>
<ol>
<li>base folder : /frontend/views/template</li>
<li>base folder + path ê°’ì— í•´ë‹¹í•˜ëŠ” htmlí˜ì´ì§€ë¥¼ ì°¾ìŒ</li>
<li>ìµœì¢… ipo-card.htmlì„ jinja2ì˜ ì†ŒìŠ¤ë¡œ ì‚¬ìš©</li>
<li>jinja2 ë¡œ renderingëœ htmlì„ ë¦¬í„´í•´ ì¤Œ. ì´ë•Œ renderingì— ì‚¬ìš©ë˜ëŠ” ê°’ë“¤ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹ˆë‹¤</li>
</ol>
</li>
</ul>
<pre><code class="language-python">    context = {
        &quot;request&quot;: request, 
        &quot;today&quot; : today,
        &quot;page_path&quot;: path, 
        &quot;user_id&quot;: current_user[&quot;user_id&quot;], 
        &quot;user_name&quot;: current_user[&quot;user_name&quot;],
        &quot;stk_code&quot; : stk_code
    }
    # id = ipo_calendar ì™€ ê°™ì€ í˜•ì‹ì´ê³  ì´ë¥¼ ë¶„ë¦¬í•œë‹¤.
    template_path = path.lstrip('/') 
    template_page = f&quot;template/{template_path}.html&quot;
    logger.debug(f&quot;template_page í˜¸ì¶œë¨: {template_page}&quot;)
    return render_template(template_page, context)    
</code></pre>
<ul>
<li>
<p>template rendering</p>
<ul>
<li>templateë€ handlebarì˜ templateë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.</li>
<li>ìƒê¸° ê¸°ìˆ í•œ /page urlì—ì„œ renderingë˜ëŠ” í˜ì´ì§€ëŠ” ì‹¤ì œì ì¸ ë°ì´í„°ë¥¼ ê°–ê³  ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.</li>
<li>ë‹¨, document ê°€ ì¤€ë¹„ë˜ë©´ í•„ìš”í•œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” êµ¬ì¡°ë¡œ ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
<ol>
<li>í™”ë©´ì— ë³´ì—¬ì¤„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.</li>
<li>handlerbarë¥¼ ì´ìš©í•´ì„œ rendering.í•œë‹¤.</li>
</ol>
</li>
</ul>
</li>
</ul>
<pre><code class="language-javascript">    function display_mystocks() {
        fetch(&quot;/api/v1/mystock&quot;)
        .then(response =&gt; response.json())
        .then(data =&gt; {
            $(&quot;#list-area&quot;).empty();
            //2. ê°€ì ¸ì˜¨ ë°ì´í„°ëŠ” handlerbarë¥¼ ì´ìš©í•´ì„œ renderingí•œë‹¤.
            var template = Handlebars.compile($(&quot;#mystock_list_template&quot;).html());
            $(&quot;#list-area&quot;).html(template({list: data}));
        })
        .catch(error =&gt; {
            console.log(error);
        });
    }
    $(document).ready(function() {
        ....
        display_mystocks(); //1. í™”ë©´ì— ë³´ì—¬ì¤„ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ë‹¤.
    });
</code></pre>
<ul>
<li>/template url
<ul>
<li>ìƒê¸° ê¸°ìˆ í•œ ê¸°ë³¸ì ì¸ í˜ì´ì§€ renderingì™¸ì— /template urlë¡œ handlebarì˜ ì†ŒìŠ¤ scriptë¥¼  ê°€ì ¸ì™€ì„œ ì‚¬ìš© í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li>handlebar ì†ŒìŠ¤ scriptê°€ ë„ˆë¬´ ë³µì¡í•  ê²½ìš°, í˜ì´ì§€ì— ë„ˆë¬´ ë§ì€ handlerbar ì†ŒìŠ¤ scriptê°€ ì¡´ì¬í•  ê²½ìš°, ì—¬ëŸ¬ ê³³ì—ì„œ ì‚¬ìš©í•˜ëŠ” handlerbar ì†ŒìŠ¤ scriptì¼ ê²½ìš° ìœ ìš©í•©ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
<h3>4.1 frontend ì£¼ìš” javascript ëª¨ë“ˆ</h3>
<ul>
<li>
<p>billboard_candle_chart.js : naverì—ì„œ ì œê³µí•˜ëŠ” open source <a href="https://naver.github.io/billboard.js/release/latest/doc/">billboard</a>ë¥¼ ì‚¬ìš©í•˜ì—¬ candle ì± íŠ¸ë¥¼ ê·¸ë¦¬ëŠ” ëª¨ë“ˆ</p>
</li>
<li>
<p>calendar-utiliity.js : ë‹¬ë ¥ì„ ê·¸ë¦¬ê³  í•´ë‹¹í•˜ëŠ” ë‚ ì§œì˜ ipoì •ë³´ë¥¼ í‘œì‹œ</p>
</li>
<li>
<p>common.js : í”„ë¡œì íŠ¸ ì „ë°˜ì— ê±¸ì³ì„œ ì‚¬ìš©ë˜ëŠ” javascript utilityí•¨ìˆ˜ë“¤ ëª¨ìŒ</p>
</li>
<li>
<p>fetch-util.js : Lucyì—ì„œëŠ” javascriptìì²´ì˜ fetchí•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©° ê·¸ fetchí•¨ìˆ˜ë¥¼ ë² ì´ìŠ¤ë¡œ ë§Œë“  ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤</p>
</li>
<li>
<p>handlebar-helpers.js : handlebar í—¬í¼í•¨ìˆ˜ ëª¨ìŒ</p>
</li>
<li>
<p>ipo_helper : IPOìš© handlebar í—¬í¼í•¨ìˆ˜ ëª¨ìŒ</p>
</li>
<li>
<p>lucy_main.js : lucyì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” í™”ë©´ê³¼ ê´€ë ¨ëœ javascriptí•¨ìˆ˜ë“¤</p>
<ul>
<li>ë§¤ìˆ˜/ë§¤ë„ canvas í•¨ìˆ˜</li>
<li>alert í•¨ìˆ˜</li>
<li>íšŒì‚¬ì •ë³´ canvas í•¨ìˆ˜</li>
</ul>
<pre><code class="language-javascript">  window.showBuySellCanvas = showBuySellCanvas;
  window.showToastError = showToastError;
  window.showCompanyCanvas = showCompanyCanvas;
  window.showAlertError = showAlertError;
</code></pre>
<ul>
<li>lucy_websocket.js : ì„œë²„ (lucy backend)ë¡œë¶€í„° ë°›ëŠ” websocket ë°ì´í„°ë¥¼ ìœ„í•œ í•¨ìˆ˜ë“¤</li>
<li>tab-manager: tab uië¥¼ ìœ„í•œ í•¨ìˆ˜</li>
</ul>
</li>
</ul>
<h3>4.2 ë°ì´í„° ë² ì´ìŠ¤</h3>
<ul>
<li>LucyëŠ” <a href="https://www.mongodb.com/ko-kr">ëª½ê³ ë°ì´í„°ë² ì´ìŠ¤</a>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</li>
<li>ëª½ê³ DBë¥¼ async ë°©ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œ <a href="https://beanie-odm.dev/">beanie</a>ì‚¬ìš©</li>
<li>DBëª… : stockdb</li>
<li>Collections ê³¼ ëŒ€ì‘í•˜ëŠ” schema
<ul>
<li>Config (config_model) : ì„¤ì •ì •ë³´ë¥¼ ì €ì¥</li>
<li>EventDays (eventdays_model) : GODATAì—ì„œ open apië¥¼ í†µí•´ì„œ ê°€ì ¸ì˜¨ íœ´ì¼ì •ë³´</li>
<li>Ipo (ipo_model) : ipo ì¼ì •ì •ë³´ ë° ìƒì„¸ ì •ë³´ë“± ì»¤ë®¤ë‹ˆì¼€ì´ì…˜38ì‚¬ì´íŠ¸ì—ì„œ ì–»ì€ ipoê´€ë ¨ ì •ë³´</li>
<li>IpoHistory (ipo_history_model) : ìƒì¥ëœ ipoì¼ì •ì— ëŒ€í•´ì„œ ì˜ˆìƒì²´ê²°ê°€ë¥¼ ì‚°ì •í•˜ê¸° ìœ„í•œ ì •ë³´</li>
<li>SchedulerJob (schduler_job_model) : ìŠ¤ì¼€ì¤„ëŸ¬ì— ë“±ë¡ë  job ì •ë³´</li>
<li>Users (user_model) : ì‚¬ìš©ìì˜ ê³„ì¢Œì •ë³´ë“±</li>
</ul>
</li>
</ul>
<h2>4. ì‚¬ìš©ì í™”ë©´ ì„¤ëª…</h2>
<h3>4.1 ê°œìš”</h3>
<p>ì‚¬ìš©ì í™”ë©´ì€ ì²˜ìŒ ê¸°íšê³¼ëŠ” ë‹¬ë¦¬ ë²•ì¸ì‚¬ìš©ìê°€ ì•„ë‹Œ ê°œì¸ ì‚¬ìš©ìë¡œ ì‘ì„±ë˜ì—ˆìœ¼ë©°, ë§¤ìˆ˜/ë§¤ë„ ì£¼ë¬¸, ì²´ê²°í†µë³´ì™¸ì— IPOê´€ë ¨ ë©”ë‰´ë¥¼ ê°–ê³  ìˆìœ¼ë©°, ë¯¸ì™„ì„±ê¸°ëŠ¥ìœ¼ë¡œ ë‹¨íƒ€ë¨¸ì‹ ì˜ ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.
ë˜í•œ, KIS,LSì˜ ì—¬ëŸ¬ apië¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì´ ìˆìŠµë‹ˆë‹¤.
ê·¸ëŸ¬ë‚˜ ì œê³µë˜ëŠ” ë°ì´í„°ì˜ 2ì°¨ ê°€ê³µ ë° ì˜ë¯¸ìˆëŠ” íŒë‹¨ì„ ë‚´ë¦¬ëŠ” ê¸°ëŠ¥ì€ ì—†ìŠµë‹ˆë‹¤.</p>
<p>ë˜í•œ ë‹¨íƒ€ë¨¸ì‹ ì€ ìë™ìœ¼ë¡œ ë§¤ìˆ˜/ë§¤ë„ì˜ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê³  telegramì„ í†µí•´ì„œ ì‚¬ìš©ìì—ê²Œ informationì„ ì£¼ë„ë¡ ê¸°íší–ˆìœ¼ë‚˜ ì‹¤íš¨ì„±ì˜ ë¬¸ì œ(ì¦‰ ìë™ìœ¼ë¡œ ìˆ˜í–‰ì‹œ ì†ì‹¤ì´ í´ ìˆ˜ ìˆìŒ)ì™€
ì‹œê°„ìƒì˜ ë¬¸ì œë¡œ ê°œë°œ ì¤‘ì— í”„ë¡œì íŠ¸ê°€ ë˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
<h3>4.2 ë©”ë‰´ êµ¬ì„± ë° ì„¤ëª…</h3>
<ul>
<li>
<p>ê³µëª¨ì£¼</p>
<ul>
<li>ê³µëª¨ì£¼ - ìƒì„¸ : ê³µëª¨ì£¼ ë‚´ìš© í‘œì‹œ</li>
<li>ê³µë¬´ì£¼ - ë‹¬ë ¥ : ë‹¬ë ¥ ìƒì— ê³µëª¨ì£¼ ì¼ì • (ì²­ì•½ì¼,í™˜ë¶ˆì¼,ìƒì¥ì¼) í‘œì‹œ</li>
<li>ê³µëª¨ì£¼ - ê¸°ë¡ : ì§€ë‚œ ê³µëª¨ì£¼ì™€ ìƒì¥ì¼ ìµœê³ ì•¡ í‘œì‹œ ë° ì˜ˆìƒì²´ê²°ê°€ ê³µì‹ ì‚°ì¶œ</li>
</ul>
</li>
<li>
<p>ì¢…ëª©ì°¾ê¸°</p>
<ul>
<li>My Stock : ì£¼ì‹ ì¢…ëª©ì„ ë³´ìœ /ê´€ì‹¬/ë‹¨íƒ€ë¡œ êµ¬ë¶„í•˜ì—¬ í‘œì‹œ, 10ì´ˆë§ˆë‹¤ í˜„ì¬ê°€ë¥¼ ê°±ì‹ </li>
<li>ì£¼ë‹¬ê²€ìƒ‰  : ì£¼ë‹¬ì‚¬ì´íŠ¸ì—ì„œ scrappingí•œ ë°ì´í„°ë¡œ ê²€ìƒ‰</li>
<li>ì™¸êµ­ì¸ ë§¤ë§¤ì¡°ëª© : ì™¸êµ­ì¸ ë§¤ë§¤ ì¤‘ ìƒìœ„ ì¢…ëª© í‘œì‹œ</li>
<li>ì¦ê¶Œì‚¬-íˆ¬ìì˜ê²¬ : ì¦ê¶Œì‚¬ì˜ íˆ¬ìì˜ê²¬ë¥¼ íšŒì›ì‚¬ë³„ ê´´ë¦¬ìœ¨ ë³„ë¡œ í‘œì‹œ</li>
<li>KIS-ê´€ì‹¬ì¢…ëª© : KIS(í•œêµ­íˆ¬ìì¦ê¶Œ)ì˜ HTSë¥¼ í†µí•´ì„œ ì¶”ê°€í•œ ê´€ì‹¬ê·¸ë£¹ê³¼ ì†í•œ ì¢…ëª© í‘œì‹œ</li>
<li>KIS-ì¡°ê±´ì‹ : KISì˜ HTSë¥¼ í†µí•´ì„œ ë“±ë¡í•œ ì¡°ê±´ì‹ì˜ ì¡°íšŒ ë° ì¡°ê±´ì‹ì„ ìˆ˜í–‰í•œ ê²°ê³¼ í‘œì‹œ</li>
<li>KIS-ìƒìœ„ì¢…ëª© : KISì˜ ì‹œê°„ì™¸í˜¸ê°€ì”ëŸ‰ê³¼ í˜¸ê°€ì”ëŸ‰ì„ ì¡°íšŒ</li>
<li>LS-ìƒìœ„ì¢…ëª© : LSì¦ê¶Œì‚¬ì˜ ë“±ë½ë¥ ,ê±°ë˜ëŸ‰ ë“±ìœ¼ë¡œ ê¸ˆì¼/ì „ì¼ì˜ ìƒìœ„ì¢…ëª© ì¡°íšŒ</li>
</ul>
</li>
<li>
<p>ë‹¨íƒ€ë¨¸ì‹  : ë‹¨íƒ€ë¨¸ì‹  ê´€ë¦¬í˜ì´ì§€</p>
</li>
<li>
<p>í•œêµ­íˆ¬ìì¦ê¶Œ</p>
<ul>
<li>KIS ê³„ì¢Œ : ë“±ë¡ëœ í•œêµ­íˆ¬ìì¦ê¶Œ ê³„ì¢Œì˜ ìƒíƒœ ë° ë³´ìœ  ì¢…ëª©ì— ëŒ€í•œ ê¸ˆì•¡ì •ë³´ í‘œì‹œ</li>
<li>ì¼ë³„ì£¼ë¬¸ì²´ê²° : ì¼ìë¡œ ì²´ê²°ëœ ì •ë³´ ì¡°íšŒ</li>
</ul>
</li>
<li>
<p>LSì¦ê¶Œ</p>
<ul>
<li>LSê³„ì¢Œ : ë“±ë¡ëœ ê³„ì¢Œì˜ ìƒíƒœì™€ ë³´ìœ  ì¢…ëª©ì— ëŒ€í•œ ê¸ˆì•¡ì •ë³´ í‘œì‹œ</li>
<li>ê±°ë˜ë‚´ì—­ : ì¼ìë¡œ ê±°ë˜ë‚´ì—­ ë° ì²´ê²°ì •ë³´ ì¡°íšŒ</li>
</ul>
</li>
<li>
<p>ë‚˜ì˜ ì£¼ì‹ì •ë³´ : ì£¼ì‹ì¢…ëª©ì„ ë³´ìœ /ê´€ì‹¬/ë‹¨íƒ€ë¡œ ë¶„ë¥˜í•˜ì—¬ í˜„ì¬ê°€ë¥¼ í‘œì‹œ, 10ì´ˆë§ˆë‹¤ ê°€ê²©ì •ë³´ë¥¼ ì‹¤ì œ ê°€ê²©ìœ¼ë¡œ ì¡°íšŒ</p>
</li>
<li>
<p>ì„¤ì • ë° ìŠ¤ì¼€ì¤„ : ì„¤ì • ë° Scheduler ì •ë³´ í‘œì‹œ ë° ìˆ˜ì •</p>
</li>
<li>
<p>ì‚¬ìš©ì ì •ë³´ : ì‚¬ìš©ìì˜ ê¸°ë³¸ì •ë³´ì™€ ê³„ì¢Œì •ë³´ë¥¼ í‘œì‹œ ìˆ˜ì •</p>
</li>
</ul>
<h3>4.3 í™”ë©´ ìº¡ì³ ë° ì„¤ëª…</h3>
<h4>4.3.1 ë¡œê·¸ì¸ / ë©”ì¸í™”ë©´</h4>
<ul>
<li>
<p><strong>ë¡œê·¸ì¸</strong>
<img src="./images/login.png" alt="ë¡œê·¸ì¸" /></p>
<ul>
<li>id/pw ë¡œê·¸ì¸ì‹œ /login urlí˜¸ì¶œ jwt tokenì„ ë°œê¸‰ë°›ìŒ.</li>
<li>fulldown ë©”ë‰´ë¥¼ ì‚¬ìš©</li>
<li>loginì‚¬ìš©ì í‘œì‹œ</li>
</ul>
</li>
<li>
<p><strong>ë©”ì¸í™”ë©´</strong>
<img src="./images/main.png" alt="ë©”ì¸í™”ë©´" /></p>
<ul>
<li>fulldown menuë¥¼ ì‚¬ìš©í•¨.</li>
<li>ë‚˜ì˜ ì£¼ì‹ ìƒí™©ê³¼ Websocketì—°ê²°ìƒíƒœë¥¼ í‘œì‹œ</li>
</ul>
</li>
</ul>
<h4>4.3.2 ê³µëª¨ì£¼</h4>
<ul>
<li>
<p><strong>ê³µëª¨ì£¼-ëª©ë¡(ìƒì„¸)</strong>
<img src="./images/ipo-list.png" alt="ipo-list" /></p>
<ul>
<li>ì»¤ë®¤ë‹ˆì¼€ì´ì…˜38ì—ì„œ scrappingí•œ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤Œ.</li>
<li>ìŠ¤íŒ©ì€ ë‹¤ë¥¸ ìŠ¤íƒ€ì¼ë¡œ ë³´ì—¬ì¤Œ</li>
<li>ì˜ˆìƒì²´ê²°ê°€ë¥¼ êµ¬í•  ìˆ˜ ìˆëŠ” ê²ƒì€ IPOê³¼ê±°ë°ì´í„° ê¸°ë¡ì„ ì°¸ì¡°í•˜ì—¬ ìƒì‚°í•œ ìˆ˜ì‹ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ì‚°ì¶œ</li>
<li>ì°¾ê¸°ê¸°ëŠ¥ê³¼ ìµœê·¼ scrappingì¼ì‹œë¥¼ ë³´ì—¬ì¤Œ</li>
</ul>
</li>
<li>
<p><strong>ê³µëª¨ì£¼-ë‹¬ë ¥</strong>
<img src="./images/ipo-calendar.png" alt="ipo-calendar" /></p>
<ul>
<li>ë‹¬ë ¥ì— ê³µëª¨ì£¼ ì²­ì•½ì¼,í™˜ë¶ˆì¼,ìƒì¥ì¼ì„ í‘œì‹œ</li>
</ul>
</li>
<li>
<p><strong>ê³µëª¨ì£¼ ê³¼ê±°ë°ì´í„° ê¸°ë¡</strong>
<img src="./images/ipo-history.png" alt="ipo-hisotory" /></p>
<ul>
<li>ê³µëª¨ì£¼ ìƒì¥ì¼ì— ìµœê³ ì²´ê²°ê°€ë¥¼ í™•ì¸í•´ì„œ ìˆ˜ì‹ì„ ë§Œë“¬.</li>
<li>ìˆ˜ì‹ì€ ì„ í˜•íšŒê·€ì‹ì„ ì‚¬ìš©í•¨.</li>
<li>ì¸ìë¡œ ì‚¬ìš©ëœ í•­ëª©ì€ í™•ì •ê³µëª¨ê°€, ë§¤ì¶œì•¡, ê¸°ê´€ê²½ìŸë¥ , ì˜ë¬´ë³´ìœ í™•ì•½ì„.</li>
<li>ìˆ˜ì‹ë§Œë“¤ê¸°ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ í˜„ì¬ê¹Œì§€ ì¶•ì ëœ ë°ì´í„°ë¡œ ì„ í˜•íšŒê·€ì‹ì„ ë§Œë“¬.</li>
<li>ë§Œë“¤ì–´ì§„ ë°ì´í„°ëŠ” dbì˜ Config collectionì— ì €ì¥ë¨</li>
</ul>
<pre><code class="language-json">  {
  &quot;key&quot;: &quot;ipo_expected_cost_express&quot;,
  &quot;mode&quot;: &quot;System&quot;,
  &quot;value&quot;: &quot;(2.925374714862828e-05 * ë§¤ì¶œì•¡) + (0.0016757608759126886 * ê¸°ê´€ê²½ìŸë¥ ) + (0.008617509095604907 * ì˜ë¬´ë³´ìœ í™•ì•½) + 0.6401964822960602&quot;,
  &quot;note&quot;: &quot;ì²´ê²°ì˜ˆìƒê°€_ë°°ìœ¨ì„  ë§¤ì¶œì•¡, ê¸°ê´€ê²½ìŸë¥ , ì˜ë¬´ë³´ìœ í™•ì•½ 3ê°€ì§€ë¡œ ê³µëª¨ê°€ì˜ ë°°ìœ¨ì„ êµ¬í•˜ëŠ” ê³µì‹&quot;,
  &quot;editable&quot;: true
  }
</code></pre>
<ul>
<li>ìˆ˜ì‹ì€ ipo-ëª©ë¡(ìƒì„¸)ì—ì„œ ì˜ˆìƒì²´ê²°ê°€ë¥¼ êµ¬í•˜ëŠ”ë° ì‚¬ìš©ë¨</li>
</ul>
<h4>4.3.3 ì¢…ëª©ì°¾ê¸°</h4>
<ul>
<li>
<p>ì¢…ëª©ì°¾ê¸°ëŠ” íˆ¬ìì¢…ëª©ì„ ì„ íƒí•˜ê¸° ìœ„í•´ì„œ ì—¬ëŸ¬ê°€ì§€ ì†ŒìŠ¤ì—ì„œ ìë£Œë¥¼ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ê²€ìƒ‰í•œ ìë£Œì—ì„œ ì„ íƒí•˜ì—¬ ë‚˜ì˜ ì£¼ì‹(My Stock)ì— ì¶”ê°€í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ë‚˜ì˜ ì£¼ì‹</strong>
<img src="./images/mystock.png" alt="mystock" /></p>
</li>
<li>
<p>ë‚˜ì˜ ì£¼ì‹ì€ ë³´ìœ ,ê´€ì‹¬,ë‹¨íƒ€ 3ê°€ì§€ ë¶„ë¥˜ì— ë‹¤ì¤‘ìœ¼ë¡œ ì†Œì†ë˜ë©° í˜„ì¬ê°€ëŠ” ì¥ì¤‘ì¼ë•Œ 10ì´ˆë§ˆë‹¤ ê°±ì‹ í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ë³´ìœ ë²„íŠ¼ì€ í˜„ì¬ ì‚¬ìš©ìì˜ KIS,LSì˜ ê³„ì¢Œë‚´ìš©ì„ ê²€ìƒ‰í•´ì„œ ìë™ìœ¼ë¡œ ë³´ìœ  íƒœê·¸ë¥¼ ê° ì£¼ì‹ ì¢…ëª©ì— ë¶€ì—¬í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì£¼ë‹¬ê²€ìƒ‰</strong></p>
</li>
<li>
<p><img src="./images/judal.png" alt="judal" /></p>
</li>
<li>
<p><a href="https://www.judal.co.kr/">ì£¼ë‹¬</a>ì‚¬ì´íŠ¸ì˜ ë‚´ìš©ì„ schedulerì—ì„œ ì •í•´ì§„ ì‹œê°„ì— scrappingí•˜ì—¬ data/judalí´ë”ì— ë‚ ì§œë³„ë¡œ ì €ì¥í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ì €ì¥ëœ ë°ì´í„°ëŠ” csvíŒŒì¼ì˜ í˜•íƒœë¡œ ì €ì¥ë©ë‹ˆë‹¤</p>
</li>
<li>
<p>ì €ì¥ëœ ë°ì´í„° ì¤‘ ê°€ì¥ ìµœê·¼ì˜ ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê° ì¢…ëª©ì„ ê²€ìƒ‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>ì™¸êµ­ì¸ ë§¤ë§¤ ì¢…ëª©</strong>
<img src="./images/foregin.png" alt="ì™¸êµ­ì¸ë§¤ë§¤ì¢…ëª©" /></p>
</li>
<li>
<p>í•œêµ­íˆ¬ìì¦ê¶Œì˜ apiì¤‘ 'êµ­ë‚´ê¸°ê´€_ì™¸êµ­ì¸-&gt;ë§¤ë§¤ì¢…ëª©ê°€ì§‘ê³„'ì„ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤€ë‹¤.</p>
</li>
<li>
<p><strong>ì¦ê¶Œì‚¬ íˆ¬ìì˜ê²¬</strong>
<img src="./images/opniion.png" alt="ì¦ê¶Œì‚¬íˆ¬ìì˜ê²¬" /></p>
</li>
<li>
<p>í•œêµ­íˆ¬ìì¦ê¶Œì˜ apiì¤‘ 'êµ­ë‚´ì£¼ì‹ ì¢…ëª©íˆ¬ìì˜ê²¬'ì„ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë³´ì—¬ì¤€ë‹¤.</p>
</li>
<li>
<p><strong>KISê´€ì‹¬ì¢…ëª© ê·¸ë£¹</strong>
<img src="./images/kis_interisting.png" alt="kisê´€ì‹¬ì¢…ëª©" /></p>
</li>
<li>
<p>KIS(í•œêµ­íˆ¬ìì¦ê¶Œ)ì˜ HTSì—ì„œ ê´€ì‹¬ì¢…ëª© ê·¸ë£¹ì„ ë§Œë“¤ê³  ê° ê·¸ë£¹ì— ì¢…ëª©ì„ ì¶”ê°€í–ˆì„ ê²½ìš°</p>
</li>
<li>
<p>ê·¸ë£¹ì˜ ëª©ë¡ê³¼ ê·¸ë£¹ë³„ë¡œ ì¶”ê°€ëœ ì¢…ëª©ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>KIS ì¡°ê±´ì‹</strong>
<img src="./images/kis-condition.png" alt="kis-condition" /></p>
</li>
<li>
<p>KIS HTSì—ì„œ ì¶”ê°€í•œ ì¡°ê±´ì‹ë¦¬ìŠ¤íŠ¸ë¥¼ ë³´ì—¬ì£¼ê³  í´ë¦­ì‹œ ì¡°ê±´ì‹ì´ ìˆ˜í–‰ë˜ë©´ì„œ ê²€ìƒ‰í•œ ì¢…ëª©ë“¤ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>KIS ìƒìœ„ì¢…ëª©</strong>
<img src="./images/kis-rank.png" alt="kis-rank" /></p>
</li>
<li>
<p>í•œêµ­íˆ¬ìì¦ê¶Œì˜ apiì¤‘ 'ì‹œê°„ì™¸í˜¸ê°€ì”ëŸ‰ìˆœìœ„'ê³¼ 'í˜¸ê°€ì”ëŸ‰ìˆœìœ„' apië¥¼ ì´ìš©í•˜ì—¬ ì¢…ëª©ì„ ê²€ìƒ‰í•˜ì—¬ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>LS-ìƒìœ„ì¢…ëª©
<img src="./images/ls-rank.png" alt="ls-rank" /></p>
</li>
<li>
<p>LS ì¦ê¶Œì—ì„œ ì œê³µí•˜ëŠ” ê° ì§€ìˆ˜ë³„ë¡œ ìƒìœ„ì¢…ëª©ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ì§€ìˆ˜ëŠ” ë“±ë½ë¥ , ê±°ë˜ëŸ‰, ì „ì¼ë™ì‹œê°„ëŒ€ë¹„ ê±°ë˜ê¸‰ì¦, ì‹œê°„ì™¸ë“±ë½ìœ¨, ì‹œê°„ì™¸ê±°ë˜ëŸ‰, ì˜ˆìƒì²´ê²°ëŸ‰, ë‹¹ì¼ê°€ì˜ˆìƒë“±ë½ìœ¨, ê±°ë˜ëŒ€ê¸ˆ ì…ë‹ˆë‹¤.</p>
</li>
</ul>
<h4>4.3.4 í•œêµ­íˆ¬ìì¦ê¶Œ</h4>
<ul>
<li>
<p>í•œêµ­íˆ¬ìì¦ê¶Œ ê³„ì¢Œì— ëŒ€í•œ ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>KISê³„ì¢Œ</strong>
<img src="./images/kis-account.png" alt="kisê³„ì¢Œ" /></p>
</li>
<li>
<p>ì‚¬ìš©ìì˜ í•œêµ­íˆ¬ìì¦ê¶Œ ê³„ì¢Œì˜ ê³„ì¢Œì •ë³´(ì˜ˆìˆ˜ê¸ˆë“±)ì™€ ë³´ìœ  ì¢…ëª©ì˜ ëª©ë¡ê³¼ ì¢…ëª©ì˜ í˜„ì¬ê°€ ë“±ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ë§Œì•½ ë§¤ìˆ˜/ë§¤ë„ì˜ í˜„ì¬ê°€ê°€ ì•„ë‹Œ ê¸ˆì•¡ìœ¼ë¡œ ì£¼ë¬¸ì„ ë„£ì—ˆì„ ê²½ìš° ì˜¤ëŠ˜ì˜ ë¯¸ì²´ê²°ì— í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ì£¼ì‹ ì¼ë³„ì£¼ë¬¸ì²´ê²°
<img src="./images/kis-chegeol.png" alt="ì¼ë³„ì£¼ë¬¸ì²´ê²°" /></p>
</li>
<li>
<p>KISê³„ì¢Œì—ì„œ ì²´ê²°ëœ ì •ë³´ë¥¼ ì¼ìë³„ë¡œ ì¡°íšŒí•©ë‹ˆë‹¤.</p>
</li>
</ul>
<h3>4.3.5 LSì¦ê¶Œ</h3>
<ul>
<li>
<p>LSì¦ê¶Œ ê³„ì¢Œì— ëŒ€í•œ ì •ë³´ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>LSê³„ì¢Œ</strong>
<img src="./images/ls-account.png" alt="LSê³„ì¢Œ" /></p>
</li>
<li>
<p>ì‚¬ìš©ìì˜ LSê³„ì¢Œì— ëŒ€í•œ ì˜ˆìˆ˜ê¸ˆë“±ì˜ ì •ë³´ì™€ ë³´ìœ  ì¢…ëª©ì˜ ëª©ë¡ê³¼ ì¢…ëª©ì˜ í˜„ì¬ê°€ ë“±ì„ í‘œì‹œí•©ë‹ˆë‹¤.</p>
</li>
<li>
<p><strong>LSì¦ê¶Œ ê±°ë˜ë‚´ì—­</strong>
<img src="./images/ls-chegeul.png" alt="LSê±°ë˜ë‚´ì—­" /></p>
</li>
<li>
<p>LSê³„ì¢Œì—ì„œ ì²´ê²°ëœ ì •ë³´ ë° ê±°ë˜ë‚´ì—­ì„ ì¡°íšŒí•©ã…ˆë‹ˆë‹¤.</p>
</li>
</ul>
<h3>4.3.6 ë§¤ìˆ˜/ë§¤ë„</h3>
<ul>
<li>ë§¤ìˆ˜/ë§¤ë„ëŠ” ëª¨ë“  ë©”ë‰´ì—ì„œ í˜¸ì¶œë  ìˆ˜ ìˆë„ë¡ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë©° bootstrapì˜ canvasë¥¼ ì´ìš©í•´ì„œ UIë¥¼ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.
<img src="./images/buysell.png" alt="ë§¤ìˆ˜ë§¤ë„" /></li>
<li>ì¦ê¶Œì‚¬ë¥¼ ì„ íƒí•˜ê³  ìƒí’ˆë²ˆí˜¸(stock code)ë¥¼ ì…ë ¥ í›„ ìˆ˜ëŸ‰ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•œ í›„ ë§¤ìˆ˜/ë§¤ë„ ë²„íŠ¼ì„ í´ë¦­í•¨ìœ¼ë¡œì„œ í•´ë‹¹ ì¦ê¶Œì‚¬ì— ì£¼ë¬¸ì„ ë„£ê²Œ ë©ë‹ˆë‹¤.</li>
<li>ì´ë•Œ ê¸ˆì•¡ì´ 0ì¼ ê²½ìš° ì‹œì¥ê°€ë¡œ ì£¼ë¬¸ì´ ë“¤ì–´ê°€ê²Œ ë©ë‹ˆë‹¤.</li>
<li>í˜„ì¬ ë©”ë‰´ì— ë”°ë¼ì„œ ì¦ê¶Œì‚¬ê°€ ìë™ì„ íƒë  ìˆ˜ ìˆìœ¼ë©° ë§¤ìˆ˜/ë§¤ë„ ìˆ˜ëŸ‰ì€ ê¸°ë³¸ì ìœ¼ë¡œ 1ë¡œ, ì‹œì¥ê°€ 0ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤.</li>
</ul>
<h3>4.3.7 fulldown ì˜¤ë¥¸ìª½ ë©”ë‰´</h3>
<ul>
<li>fulldown ë©”ë‰´ì˜ ì˜¤ë¥¸ìª½ ë©”ë‰´ëŠ” ë¬¸ìì—´ì´ ì•„ë‹ˆë¼ ì•„ì´ì½˜ìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆìŠµë‹ˆë‹¤.
<img src="./images/right-menu.png" alt="right-menu" />
-ìˆœì„œëŒ€ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ëŠ¥ì…ë‹ˆë‹¤.</li>
</ul>
<ol>
<li>ë³„í‘œ : ë‚˜ì˜ ì£¼ì‹(My Stock)</li>
<li>ìƒˆë¡œê³ ì¹¨ : ê° ë©”ë‰´ë§ˆë‹¤ í˜„ì¬ê°€ê°€ ìˆëŠ” ê²½ìš° ëª¨ë“  í˜ì´ì§€ì—ì„œ ìë™ìœ¼ë¡œ ê°±ì‹ ë˜ì§€ ì•Šì„ ê²½ìš°ì— ì‚¬ìš©ê°€ëŠ¥</li>
<li>ë‚ ì§œì™€ ìš”ì¼ : ê±°ë˜ì¼ì™€ ê±°ë˜ì‹œê°„ì— ë”°ë¼ì„œ ê° í™”ë©´ì´ ë‹¬ë¦¬ ì‘ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li>ì„¤ì • : ì‹œìŠ¤í…œ ì„¤ì • ì‚¬í•­ì™€ ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • í˜„í™©</li>
<li>ì‚¬ìš©ì : ì‚¬ìš©ì ì •ë³´</li>
</ol>
<h3>4.3.8 ì„¤ì •</h3>
<p><img src="./images/config.png" alt="config" /></p>
<ul>
<li>
<p>LucyëŠ” ìƒìˆ˜ê°’ì— í•´ë‹¹í•˜ëŠ” ê°’ì„ .env<profile>ê³¼ ëª½ê³ dbì˜ config collectionì— ë„£ì–´ ë‘ê³  ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ëª½ê³ dbì—ì„œ ê´€ë¦¬í•˜ëŠ” ì„¤ì •ê°’ì„ ì¡°íšŒ, í¸ì§‘ê°€ëŠ¥í•©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ì„¤ì •ê°’ë“¤ì€  Config collectionì— ì €ì¥ë©ë‹ˆë‹¤.</p>
</li>
<li>
<p>ëª½ê³ dbì—ì„œ ê´€ë¦¬í•˜ëŠ” ì„¤ì •ê°’</p>
<ul>
<li>ip_expected_cost_express : IPOì˜ ì˜ˆìƒì²´ê²°ê°€ ê³µì‹ (IPO ê³¼ê±°ê¸°ë¡ì—ì„œ ì‚°ì¶œ, IPOëª©ë¡ì—ì„œ ì˜ˆìƒì²´ê²°ê°€ ì‚°ì¶œ)</li>
<li>38-scrapping-time : ì»¤ë®¤ë‹ˆì¼€ì´ì…˜38ì—ì„œ scrappingí•œ ìµœì¢… ì‹œê° (Scheduler job site38_workì—ì„œ ì‚°ì¶•, IPOëª©ë¡ì—ì„œ ì‚¬ìš©)</li>
</ul>
</li>
<li>
<p>ë˜í•œ ì„¤ì •ë©”ë‰´ì—ì„œëŠ” Schedulerì˜ Job ë¦¬ìŠ¤íŠ¸ë¥¼ ì¡°íšŒ í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
<ul>
<li>scheduler jobì˜ ë™ì‘ì‹œê°„ì€ croní˜•íƒœì´ë©° í¸ì§‘ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
<li>ì„¤ì •ëœ cron jobë“¤
<ul>
<li>site38_work : <a href="https://www.38.co.kr/">ì»¤ë®¤ë‹ˆì¼€ì´ì…˜38</a> ì‚¬ì´íŠ¸ ìŠ¤í¬ë©</li>
<li>holiday_godata : <a href="https://www.data.go.kr/">ê³µê³µë°ì´í„°</a>ì—ì„œ ì œê³µí•˜ëŠ” íœ´ì¼ì •ë³´</li>
<li>LS_stk_infoì±„ìš°ê¸° : LSì •ë³´ì˜ ì¢…ëª©ì •ë³´, LSì¦ê¶Œì€ 6ìë¦¬ì˜ stkcodeì™¸ì— ìì‹ ë“¤ì´ ì§€ì •í•œ ì½”ë“œë¥¼ apiì—ì„œ ì‚¬ìš©í•˜ë„ë¡ ê°•ì œí•¨ìœ¼ë¡œ ì´ ì •ë³´ë¥¼ ì±„ì›Œë‘ì—ˆë‹¤ê°€ ì‚¬ìš©í•˜ê²Œ ë¨.</li>
<li>juda_fetch : <a href="https://www.judal.co.kr/">ì£¼ë‹¬</a>ì‚¬ì´íŠ¸ì—ì„œ scrapping</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3>4.3.9 ì‚¬ìš©ìì •ë³´</h3>
<p><img src="./images/user.png" alt="user" /></p>
<ul>
<li>ì‚¬ìš©ì ì •ë³´ë¥¼ ì¡°íšŒ, í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
<li>ì‚¬ìš©ì ì •ë³´ëŠ” ëª½ê³ dbì˜ Users collectionì— ì €ì¥ë©ë‹ˆë‹¤.</li>
<li>ì‚¬ìš©ìì˜ ê¸°ë³¸ì •ë³´ : ë¡œê·¸ì¸ì‹œ ì‚¬ìš©</li>
<li>í‚¤-ê°’ : ì‚¬ìš©ìì˜ open api ì‹ ì²­ í›„ ë°›ì€ í‚¤ ê°’
<ul>
<li>ê³µê³µë°ì´í„°ì—ì„œ ë°œê¸‰</li>
<li>DARTì—ì„œ ë°œê¸‰</li>
<li>Telegram ì—ì„œ ìƒì„±</li>
</ul>
</li>
<li>KIS, LSì˜ ê³„ì¢Œë²ˆí˜¸ ë° ì•”í˜¸</li>
<li>KIS, LSì˜ APP_KEYì™€ SECRET_KEY</li>
<li>KIS, LSì˜ TOKENì€ ë°œê¸‰ë°›ì€ í›„ ë°œê¸‰ì‹œê°„ê³¼ í•¨ê»˜ ì €ì¥ë˜ì–´ 24ì‹œê°„ ì´ë‚´ì—ì„œëŠ” ì´ ê°’ì„ ì‚¬ìš©í•˜ê²Œ ë©ë‹ˆë‹¤.</li>
</ul>
</li>
</ul>
<h2>5. ë°°í¬ ë° ìš´ì˜</h2>
<h3>5.1 ë°°í¬ ì „ëµ</h3>
<ul>
<li>ë°°í¬ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ dockerë¥¼ ì‚¬ìš©í•˜ì—¬ linuxì—ì„œ ìš´ì˜í•˜ëŠ” ê²ƒì„ ì „ì œë¡œ ìˆ˜ë¦½ë˜ì—ˆìŠµë‹ˆë‹¤.
<ul>
<li>ë°°í¬ ì„œë²„ì—ì„œëŠ” dockerê°€ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•¨.</li>
</ul>
</li>
<li>mongodbê°€ linuxì— ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šë‹¤ëŠ” ê°€ì •í•˜ì— docker-composeê°€ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</li>
<li>DockeríŒŒì¼ì€ scrappingì— í•„ìš”í•œ ì„¤ì •ë„ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</li>
</ul>
<h3>5.2 docker-compose</h3>
<pre><code class="language-yml">version: '3.8'

services:
  backend:
    build: .
    container_name: lucy-backend
    ports:
      - &quot;8000:8000&quot;
    depends_on:
      - mongo
    networks:
      - lucy-network
    environment:
      - LUCY_MODE=real
    volumes:
      - ./backend:/backend
      - ./frontend:/frontend
      - /home/kdy987/fastapi/lucy/log:/log
      - /home/kdy987/fastapi/lucy/data:/data
      - /home/kdy987/fastapi/lucy/files:/files
      - /etc/localtime:/etc/localtime:ro  # í˜¸ìŠ¤íŠ¸ ì‹œê°„ëŒ€ ì„¤ì • ë§ˆìš´íŠ¸      
    restart: always  # ì„œë²„ ì¬ì‹œì‘ ì‹œ í•­ìƒ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘

  mongo:
    image: mongo:4.4
    container_name: lucy-mongo
    ports:
      - &quot;27017:27017&quot;
    volumes:
      - /home/kdy987/fastapi/mongodb:/data/db
      - /root/fastapi-data/kdydata:/data/import
      - /etc/localtime:/etc/localtime:ro  # í˜¸ìŠ¤íŠ¸ ì‹œê°„ëŒ€ ì„¤ì • ë§ˆìš´íŠ¸            
    networks:
      - lucy-network
    command: &gt;
      bash -c &quot;
      mongod --bind_ip_all &amp;
      sleep 5 &amp;&amp;
      if ! mongo stockdb --eval 'db.Config.findOne()'; then
        mongoimport --host localhost --db stockdb --collection Config --file /data/import/stockdb.Config.json --jsonArray &amp;&amp;
        mongoimport --host localhost --db stockdb --collection SchedulerJob --file /data/import/stockdb.SchedulerJob.json --jsonArray &amp;&amp;
        mongoimport --host localhost --db stockdb --collection Users --file /data/import/stockdb.Users.json --jsonArray
      fi &amp;&amp;
      tail -f /dev/null
      &quot;
    restart: always  # ì„œë²„ ì¬ì‹œì‘ ì‹œ í•­ìƒ ì»¨í…Œì´ë„ˆë¥¼ ì¬ì‹œì‘  
volumes:
  mongo_data:

networks:
  lucy-network:

</code></pre>
<pre><code>- ëª½ê³ dbì˜ portëŠ” ê¸°ë³¸í¬íŠ¸ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
- í¬íŠ¸ëŠ” ë³€ê²½ê°€ëŠ¥í•©ë‹ˆë‹¤. ê¸°ì¡´ í¬íŠ¸ì™€ ì¶©ëŒ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.
- volumesì— ì˜í•´ host machineì— log, data, filesë¥¼ ìœ„í•œ í´ë”ê°€ ì¡´ì¬í•´ì•¼ í•©ë‹ˆë‹¤
- mongodbì˜ ì´ˆê¸°í™”ì— 3ê°œì˜ collectionì´ ì´ë¯¸  jsonìœ¼ë¡œ ë§Œë“¤ì–´ì ¸ì„œ loadingë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
</code></pre>
<h3>5.3 Dockerfile</h3>
<pre><code class="language-text">FROM python:3.12-slim

# í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN apt-get update &amp;&amp; apt-get install -y \
  wget \
  unzip \
  curl \
  gnupg2 \
  --no-install-recommends

# Google Chrome ì„¤ì¹˜
RUN wget -q -O - https://dl.google.com/linux/linux_signing_key.pub | apt-key add - &amp;&amp; \
  echo &quot;deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main&quot; &gt; /etc/apt/sources.list.d/google-chrome.list &amp;&amp; \
  apt-get update &amp;&amp; apt-get install -y google-chrome-stable

# ChromeDriver ì„¤ì¹˜
RUN CHROME_DRIVER_VERSION=`curl -sS chromedriver.storage.googleapis.com/LATEST_RELEASE` &amp;&amp; \
  wget -O /tmp/chromedriver.zip https://chromedriver.storage.googleapis.com/$CHROME_DRIVER_VERSION/chromedriver_linux64.zip &amp;&amp; \
  unzip /tmp/chromedriver.zip -d /usr/local/bin/ &amp;&amp; \
  rm /tmp/chromedriver.zip

RUN pip install --upgrade pip

# ì‘ì—… ë””ë ‰í† ë¦¬ ì„¤ì •
WORKDIR /

# í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ë¥¼ ìœ„í•´ requirements.txt íŒŒì¼ì„ ë³µì‚¬
COPY . .

# ì˜ì¡´ì„± íŒ¨í‚¤ì§€ ì„¤ì¹˜
RUN pip install --no-cache-dir -r requirements.txt


# FastAPI ì‹¤í–‰ (main.pyì—ì„œ FastAPI ê°ì²´ë¥¼ ì •ì˜í–ˆì„ ë•Œì˜ íŒŒì¼ ê²½ë¡œ)
CMD [&quot;uvicorn&quot;, &quot;backend.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8000&quot;, &quot;--log-level&quot;, &quot;debug&quot;]

</code></pre>
<ul>
<li>python:3.12-slim  ë² ì´ìŠ¤ dockerì…ë‹ˆë‹¤.</li>
<li>scrappingì„ ìœ„í•œ driverë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤</li>
</ul>
</div>

        <!-- ì¶”ê°€ ì•ˆë‚´ -->
        <div style="background-color: #f0f9ff; border-left: 4px solid #0ea5e9; padding: 8px 12px; margin-top: 16px; font-size: 13px; color: #0c4a6e;">
            <p style="margin: 0;">
                <strong>âŒ¨ï¸ ë‹¨ì¶•í‚¤:</strong> Home(ë§¨ìœ„ë¡œ) | PgUp/PgDn(í˜ì´ì§€ ì´ë™) | F2(ëª©ì°¨) | Enter/Shift+Enter(ê²€ìƒ‰ ì´ë™) | ESC(ë‹«ê¸°)
            </p>
        </div>
    </div>

    <script>
        // ë¬¸ì„œ ì •ë³´ í† ê¸€
        function toggleDocInfo() {
            const docInfoSection = document.getElementById('docInfoSection');
            const toggleBtnDesktop = document.getElementById('toggleDocInfoBtn');
            const toggleBtnMobile = document.getElementById('toggleDocInfoBtnMobile');

            docInfoSection.classList.toggle('collapsed');
            if (toggleBtnDesktop) {
                toggleBtnDesktop.classList.toggle('collapsed');
            }
            if (toggleBtnMobile) {
                toggleBtnMobile.classList.toggle('collapsed');
            }
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ í† ê¸€
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('open');
        }

        // ëª¨ë°”ì¼ ë©”ë‰´ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
        document.addEventListener('click', function(event) {
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileMenuBtn = document.getElementById('mobileMenuBtn');
            const toggleBtnMobile = document.getElementById('toggleDocInfoBtnMobile');

            if (!mobileMenu.contains(event.target) && !mobileMenuBtn.contains(event.target) && !toggleBtnMobile.contains(event.target)) {
                mobileMenu.classList.remove('open');
            }
        });

        // ì›ë³¸ ë‹¤ìš´ë¡œë“œ
        function downloadOriginal() {
            const hashcode = 'c1dd492fb2a6e923f7a6fa0701eb80d6';
            const filename = 'lucy.md';

            if (hashcode && filename) {
                // filenameì—ì„œ í™•ì¥ì ì¶”ì¶œ
                const extension = filename.split('.').pop().toLowerCase();
                // FileControllerë¥¼ í†µí•´ ìºì‹œëœ ì›ë³¸ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
                const downloadUrl = '/aview/file/' + hashcode + '.' + extension +
                                  '?download=true&name=' + encodeURIComponent(filename);
                downloadFile(downloadUrl, filename);
            } else {
                alert('ì›ë³¸ ë¬¸ì„œì˜ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        // íŒŒì¼ ë‹¤ìš´ë¡œë“œ í—¬í¼ í•¨ìˆ˜
        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            if (filename) {
                link.download = filename;
            }
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ (Ctrl+S / Cmd+S: ë‹¤ìš´ë¡œë“œ)
        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 's') {
                event.preventDefault();
                downloadOriginal();
            }
        });

        // ì´ˆê¸°í™” ë° ì½”ë“œ í•˜ì´ë¼ì´íŒ…
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Markdown Viewer loaded');
            
            // Highlight.js ì´ˆê¸°í™”
            document.querySelectorAll('pre code').forEach((block) => {
                hljs.highlightElement(block);
            });
        });
    </script>
    
    <!-- Debug Info Console Log -->
    <script>
        console.log('%cğŸ” AView Document Info', 'color: #0066cc; font-weight: bold; font-size: 14px;');
        console.log('Generated:', '2025-11-25 09:14:43');
        console.log('Hashcode:', 'c1dd492fb2a6e923f7a6fa0701eb80d6');
        console.log('Filename:', 'lucy.md');
        console.log('Template:', 'markdown.html');
        console.log('â”€'.repeat(50));
    </script>    
    
    <!-- Raw Markdown Content (hidden) -->
    <script type="text/plain" id="rawMarkdownSource"># 1. ë¬¸ì„œ ê°œìš” (Heading Level 1)

ì´ ë¬¸ì„œëŠ” **ë§ˆí¬ë‹¤ìš´ ë·°ì–´ë¥¼ í…ŒìŠ¤íŠ¸**í•˜ê¸° ìœ„í•œ ì¢…í•© ìƒ˜í”Œì…ë‹ˆë‹¤.  
ë‹¤ì–‘í•œ ë¬¸ë²• ìš”ì†Œë¥¼ í¬í•¨í•˜ê³  ìˆìœ¼ë¯€ë¡œ, ë Œë”ë§ ê²°ê³¼ë¥¼ ë¹„êµÂ·ê²€ì¦í•˜ëŠ” ìš©ë„ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ’¡ *Tip*: ì´ ë¬¸ì„œì—ëŠ” CommonMark ê¸°ë³¸ ë¬¸ë²• + GitHub Flavored Markdown(GFM)ì—ì„œ ìì£¼ ì“°ëŠ” ê¸°ëŠ¥ì„ ìµœëŒ€í•œ í¬í•¨í–ˆìŠµë‹ˆë‹¤.[^about]

---

## 1.1. í—¤ë”©(Heading) í…ŒìŠ¤íŠ¸

### 1.1.1. H3 ì œëª©

#### 1.1.1.1. H4 ì œëª©

##### 1.1.1.1.1. H5 ì œëª©

###### 1.1.1.1.1.1. H6 ì œëª©

---

# 2. í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ë° ì¸ë¼ì¸ ìš”ì†Œ

ì¼ë°˜ í…ìŠ¤íŠ¸ì…ë‹ˆë‹¤.

- *ì´íƒ¤ë¦­* (italic)
- **ë³¼ë“œ** (bold)
- ***ë³¼ë“œ+ì´íƒ¤ë¦­*** (bold + italic)
- ~~ì·¨ì†Œì„  (strikethrough)~~
- `inline code`
- <sub>ì•„ë˜ì²¨ì</sub>ì™€ <sup>ìœ„ì²¨ì</sup>  
- ì´ëª¨ì§€: ğŸ˜€ ğŸ˜ ğŸš€  

ë¬¸ì¥ ì•ˆì—ì„œ **êµµê²Œ**, *ê¸°ìš¸ì„*, ê·¸ë¦¬ê³  `ì½”ë“œ`ë¥¼ ì„ì–´ì„œ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.  
HTML íƒœê·¸ë¥¼ ì‚¬ìš©í•œ <span style="color: red; font-weight:bold;">ê°•ì¡° í…ìŠ¤íŠ¸ (HTML)</span> ë„ ì¼ë¶€ ë Œë”ëŸ¬ì—ì„œëŠ” ì§€ì›ë©ë‹ˆë‹¤.

íŠ¹ìˆ˜ ë¬¸ì ì´ìŠ¤ì¼€ì´í”„:

- ë³„í‘œ: \*literal asterisk\*
- ìƒµ: \# literal hash
- ë°±ìŠ¬ë˜ì‹œ: \\

---

# 3. ë§í¬ (Links)

## 3.1. ì¸ë¼ì¸ ë§í¬

- [OpenAI í™ˆí˜ì´ì§€](https://openai.com/)
- [GitHub](https://github.com/)
- [ìœ„í‚¤ë°±ê³¼(í•œêµ­ì–´)](https://ko.wikipedia.org/)

## 3.2. ì°¸ì¡° ìŠ¤íƒ€ì¼ ë§í¬ (Reference-style links)

ì´ê²ƒì€ [ì°¸ì¡° ë§í¬ A][ref-a] ì´ê³ , ì´ê²ƒì€ [ì°¸ì¡° ë§í¬ B][ref-b] ì…ë‹ˆë‹¤.

[ref-a]: https://www.markdownguide.org/basic-syntax/ "Markdown Guide"
[ref-b]: https://commonmark.org/ "CommonMark ê³µì‹ ì‚¬ì´íŠ¸"

## 3.3. ìë™ ë§í¬ (Autolinks)

URLì„ ì§ì ‘ ì“°ë©´ ëŒ€ë¶€ë¶„ì˜ ë·°ì–´ì—ì„œ ìë™ìœ¼ë¡œ ë§í¬ ì²˜ë¦¬ë©ë‹ˆë‹¤.

- <https://example.com>
- <mailto:someone@example.com>

---

# 4. ì´ë¯¸ì§€ (Images)

## 4.1. ê¸°ë³¸ ì´ë¯¸ì§€ (ì‚´ì•„ìˆëŠ” ì‹¤ì œ URL)

ì•„ë˜ ì´ë¯¸ì§€ëŠ” ìœ„í‚¤ë¯¸ë””ì–´ ê³µìš©ì˜ PNG íˆ¬ëª…ë„ ì˜ˆì œì…ë‹ˆë‹¤.
![ì´ë¯¸ì§€](https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png)
```md
![PNG ì˜ˆì œ ì´ë¯¸ì§€](https://upload.wikimedia.org/wikipedia/commons/4/47/PNG_transparency_demonstration_1.png)
```

# 5. ì†ŒìŠ¤ì½”ë“œ

## ìë°”
```java
public class Hello {
    public static void main(String[] args) {
        System.out.println("Hello, Markdown Viewer!");

        for (int i = 1; i <= 5; i++) {
            System.out.println("Square of " + i + " is " + (i * i));
        }
    }
}
```

## GO

```go
package main

import (
    "fmt"
)

func fib(n int) int {
    if n <= 1 {
        return n
    }
    return fib(n-1) + fib(n-2)
}

func main() {
    for i := 0; i < 10; i++ {
        fmt.Printf("%d ", fib(i))
    }
}
```
    </script>
    
    <!-- Floating TOC Button -->
    <button id="tocFloatingBtn" title="ëª©ì°¨">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
    </button>

    <!-- Top Button -->
    <button id="topBtn" title="ë§¨ ìœ„ë¡œ ì´ë™ (Home)">
        <svg width="24" height="24" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"></path>
        </svg>
    </button>

    <!-- Image Lightbox -->
    <div class="lightbox-overlay" id="lightboxOverlay">
        <button class="lightbox-close" id="lightboxClose">&times;</button>
        <img class="lightbox-content" id="lightboxImage" src="" alt="">
    </div>

    <!-- TOC Drawer -->
    <div class="toc-overlay" id="tocOverlay"></div>
    <div class="toc-drawer" id="tocDrawer">
        <div class="toc-header">
            <div class="toc-header-top">
                <span>ëª©ì°¨</span>
                <button class="toc-close-btn" id="tocCloseBtn">&times;</button>
            </div>
        </div>
        <div class="toc-content">
            <ul class="toc-list" id="tocList"></ul>
        </div>
    </div>

    <script>
        // --- Control Box Logic ---
        document.addEventListener('DOMContentLoaded', function() {
            const markdownBody = document.querySelector('.markdown-body');
            const markdownContainer = document.getElementById('markdownContainer');
            
            // State
            let currentFontSize = 16;
            let currentLineHeight = 1.6;
            let searchMatches = [];
            let currentMatchIndex = -1;
            let lastSearchQuery = '';
            
            // Font Size
            function updateFontSize(size) {
                currentFontSize = size;
                markdownBody.style.fontSize = `${size}px`;
                const resetBtn = document.getElementById('fontSizeReset');
                if(resetBtn) resetBtn.textContent = `${size}px`;
                const resetBtnMobile = document.getElementById('fontSizeReset-mobile');
                if(resetBtnMobile) resetBtnMobile.textContent = `${size}px`;
            }
            
            const fontSizeIncrease = document.getElementById('fontSizeIncrease');
            if(fontSizeIncrease) fontSizeIncrease.addEventListener('click', () => updateFontSize(currentFontSize + 1));
            
            const fontSizeDecrease = document.getElementById('fontSizeDecrease');
            if(fontSizeDecrease) fontSizeDecrease.addEventListener('click', () => updateFontSize(Math.max(10, currentFontSize - 1)));
            
            const fontSizeReset = document.getElementById('fontSizeReset');
            if(fontSizeReset) fontSizeReset.addEventListener('click', () => updateFontSize(16));

            // Mobile Font Size
            const fontSizeIncreaseMobile = document.getElementById('fontSizeIncrease-mobile');
            if(fontSizeIncreaseMobile) fontSizeIncreaseMobile.addEventListener('click', () => updateFontSize(currentFontSize + 1));
            
            const fontSizeDecreaseMobile = document.getElementById('fontSizeDecrease-mobile');
            if(fontSizeDecreaseMobile) fontSizeDecreaseMobile.addEventListener('click', () => updateFontSize(Math.max(10, currentFontSize - 1)));
            
            const fontSizeResetMobile = document.getElementById('fontSizeReset-mobile');
            if(fontSizeResetMobile) fontSizeResetMobile.addEventListener('click', () => updateFontSize(16));

            // Font Family
            const fontFamilySelect = document.getElementById('fontFamily');
            if(fontFamilySelect) {
                fontFamilySelect.addEventListener('change', (e) => {
                    document.body.style.fontFamily = e.target.value;
                    markdownBody.style.fontFamily = e.target.value;
                });
            }

            // Background Color
            const bgColorBtn = document.getElementById('bgColorBtn');
            const bgColorMenu = document.getElementById('bgColorMenu');
            
            if(bgColorBtn && bgColorMenu) {
                bgColorBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    bgColorMenu.classList.toggle('open');
                });
                
                document.addEventListener('click', (e) => {
                    if (!bgColorBtn.contains(e.target) && !bgColorMenu.contains(e.target)) {
                        bgColorMenu.classList.remove('open');
                    }
                });
            }
            
            document.querySelectorAll('.custom-color-option').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const color = e.target.dataset.color;
                    document.body.classList.remove('dark-mode'); // Disable dark mode if specific color selected
                    document.body.style.backgroundColor = color;
                    markdownBody.style.backgroundColor = color;
                    if(bgColorBtn) bgColorBtn.style.backgroundColor = color;
                    if(bgColorMenu) bgColorMenu.classList.remove('open');
                    
                    // Update active state
                    document.querySelectorAll('.custom-color-option').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });

            // Dark Mode
            function toggleDarkMode() {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                if (isDark) {
                    document.body.style.backgroundColor = '';
                    markdownBody.style.backgroundColor = '';
                } else {
                    // Restore selected background color
                    const activeColorBtn = document.querySelector('.custom-color-option.active');
                    if (activeColorBtn) {
                        const color = activeColorBtn.dataset.color;
                        document.body.style.backgroundColor = color;
                        markdownBody.style.backgroundColor = color;
                    }
                }
            }
            const toggleDarkModeBtn = document.getElementById('toggleDarkMode');
            if(toggleDarkModeBtn) toggleDarkModeBtn.addEventListener('click', toggleDarkMode);
            
            const toggleDarkModeBtnMobile = document.getElementById('toggleDarkMode-mobile');
            if(toggleDarkModeBtnMobile) toggleDarkModeBtnMobile.addEventListener('click', toggleDarkMode);

            // Line Height
            function updateLineHeight(val) {
                currentLineHeight = val;
                markdownBody.style.lineHeight = val;
            }
            const lineHeightIncrease = document.getElementById('lineHeightIncrease');
            if(lineHeightIncrease) lineHeightIncrease.addEventListener('click', () => updateLineHeight(currentLineHeight + 0.1));
            
            const lineHeightDecrease = document.getElementById('lineHeightDecrease');
            if(lineHeightDecrease) lineHeightDecrease.addEventListener('click', () => updateLineHeight(Math.max(1.0, currentLineHeight - 0.1)));
            
            const lineHeightReset = document.getElementById('lineHeightReset');
            if(lineHeightReset) lineHeightReset.addEventListener('click', () => updateLineHeight(1.6));

            // Fullscreen
            const toggleFullscreenBtn = document.getElementById('toggleFullscreen');
            if(toggleFullscreenBtn) {
                toggleFullscreenBtn.addEventListener('click', () => {
                    markdownContainer.classList.toggle('fullscreen-mode');
                });
            }

            // Search
            function performSearch(query) {
                // Remove existing highlights
                const marks = markdownBody.querySelectorAll('mark.search-highlight');
                marks.forEach(mark => {
                    const parent = mark.parentNode;
                    parent.replaceChild(document.createTextNode(mark.textContent), mark);
                    parent.normalize();
                });
                
                searchMatches = [];
                currentMatchIndex = -1;
                lastSearchQuery = query;
                
                if (!query) {
                    const counter = document.getElementById('searchCounter');
                    if(counter) counter.textContent = '';
                    const clearBtn = document.getElementById('searchClearBtn');
                    if(clearBtn) clearBtn.classList.remove('visible');
                    return;
                }

                // Recursive text node search
                function getTextNodes(node) {
                    let textNodes = [];
                    if (node.nodeType === 3) {
                        textNodes.push(node);
                    } else {
                        // Skip scripts and styles
                        if (node.tagName !== 'SCRIPT' && node.tagName !== 'STYLE') {
                            for (let child of node.childNodes) {
                                textNodes = textNodes.concat(getTextNodes(child));
                            }
                        }
                    }
                    return textNodes;
                }

                const textNodes = getTextNodes(markdownBody);
                let count = 0;
                
                textNodes.forEach(node => {
                    const text = node.nodeValue;
                    if (!text) return;
                    
                    const regex = new RegExp(query, 'gi');
                    let match;
                    const matches = [];
                    while ((match = regex.exec(text)) !== null) {
                        matches.push({ index: match.index, length: match[0].length, text: match[0] });
                    }

                    if (matches.length > 0) {
                        const fragment = document.createDocumentFragment();
                        let lastIndex = 0;
                        matches.forEach(m => {
                            fragment.appendChild(document.createTextNode(text.slice(lastIndex, m.index)));
                            const mark = document.createElement('mark');
                            mark.className = 'search-highlight';
                            mark.textContent = m.text;
                            fragment.appendChild(mark);
                            searchMatches.push(mark); // Store match reference
                            lastIndex = m.index + m.length;
                            count++;
                        });
                        fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
                        node.parentNode.replaceChild(fragment, node);
                    }
                });

                const counter = document.getElementById('searchCounter');
                if(counter) counter.textContent = count > 0 ? `${count}ê±´` : '0';
                
                // Show clear button
                const clearBtn = document.getElementById('searchClearBtn');
                if(clearBtn) clearBtn.classList.add('visible');

                // Scroll to first match
                if (searchMatches.length > 0) {
                    currentMatchIndex = 0;
                    scrollToMatch(0);
                    updateCurrentHighlight();
                }
            }

            function scrollToMatch(index) {
                if (index >= 0 && index < searchMatches.length) {
                    const match = searchMatches[index];
                    match.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            function updateCurrentHighlight() {
                searchMatches.forEach((match, idx) => {
                    if (idx === currentMatchIndex) {
                        match.classList.add('current');
                    } else {
                        match.classList.remove('current');
                    }
                });
                
                const counter = document.getElementById('searchCounter');
                if(counter && searchMatches.length > 0) {
                    counter.textContent = `${currentMatchIndex + 1}/${searchMatches.length}`;
                }
            }

            function findNext() {
                if (searchMatches.length === 0) return;
                currentMatchIndex = (currentMatchIndex + 1) % searchMatches.length;
                scrollToMatch(currentMatchIndex);
                updateCurrentHighlight();
            }

            function findPrevious() {
                if (searchMatches.length === 0) return;
                currentMatchIndex = (currentMatchIndex - 1 + searchMatches.length) % searchMatches.length;
                scrollToMatch(currentMatchIndex);
                updateCurrentHighlight();
            }

            const searchBtn = document.getElementById('searchBtn');
            if(searchBtn) searchBtn.addEventListener('click', () => {
                performSearch(document.getElementById('searchInput').value);
            });
            
            const searchInput = document.getElementById('searchInput');
            if(searchInput) {
                searchInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        if (searchInput.value !== lastSearchQuery) {
                            performSearch(searchInput.value);
                        } else {
                            if (e.shiftKey) {
                                findPrevious();
                            } else {
                                findNext();
                            }
                        }
                    } else if (e.key === 'Delete') {
                        // Clear search on Delete key
                        searchInput.value = '';
                        performSearch('');
                    }
                });
            }
            
            const searchClearBtn = document.getElementById('searchClearBtn');
            if(searchClearBtn) searchClearBtn.addEventListener('click', () => {
                document.getElementById('searchInput').value = '';
                performSearch('');
            });
            
            // Mobile Search
            const searchBtnMobile = document.getElementById('searchBtn-mobile');
            if(searchBtnMobile) searchBtnMobile.addEventListener('click', () => {
                performSearch(document.getElementById('searchInput-mobile').value);
            });
            
            const searchInputMobile = document.getElementById('searchInput-mobile');
            if(searchInputMobile) searchInputMobile.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') performSearch(e.target.value);
            });

            // Mobile Font Family
            const fontFamilySelectMobile = document.getElementById('fontFamily-mobile');
            if(fontFamilySelectMobile) {
                fontFamilySelectMobile.addEventListener('change', (e) => {
                    document.body.style.fontFamily = e.target.value;
                    markdownBody.style.fontFamily = e.target.value;
                });
            }

            // Mobile Line Height
            const lineHeightIncreaseMobile = document.getElementById('lineHeightIncrease-mobile');
            if(lineHeightIncreaseMobile) lineHeightIncreaseMobile.addEventListener('click', () => updateLineHeight(currentLineHeight + 0.1));
            
            const lineHeightDecreaseMobile = document.getElementById('lineHeightDecrease-mobile');
            if(lineHeightDecreaseMobile) lineHeightDecreaseMobile.addEventListener('click', () => updateLineHeight(Math.max(1.0, currentLineHeight - 0.1)));
            
            const lineHeightResetMobile = document.getElementById('lineHeightReset-mobile');
            if(lineHeightResetMobile) lineHeightResetMobile.addEventListener('click', () => updateLineHeight(1.6));

            // Settings Save/Reset (Desktop)
            const saveSettingsBtn = document.getElementById('saveSettings');
            if(saveSettingsBtn) saveSettingsBtn.addEventListener('click', () => {
                const settings = {
                    fontSize: currentFontSize,
                    lineHeight: currentLineHeight,
                    fontFamily: document.getElementById('fontFamily').value,
                    darkMode: document.body.classList.contains('dark-mode'),
                    bgColor: document.querySelector('.custom-color-option.active')?.dataset.color || '#ffffff',
                    tocPosition: document.querySelector('input[name="tocPosition"]:checked')?.value || 'right'
                };
                localStorage.setItem('mdViewerSettings', JSON.stringify(settings));
                alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });

            const resetSettingsBtn = document.getElementById('resetSettings');
            if(resetSettingsBtn) resetSettingsBtn.addEventListener('click', () => {
                localStorage.removeItem('mdViewerSettings');
                location.reload();
            });

            // Settings Save/Reset (Mobile)
            const saveSettingsBtnMobile = document.getElementById('saveSettings-mobile');
            if(saveSettingsBtnMobile) saveSettingsBtnMobile.addEventListener('click', () => {
                const settings = {
                    fontSize: currentFontSize,
                    lineHeight: currentLineHeight,
                    fontFamily: document.getElementById('fontFamily-mobile').value,
                    darkMode: document.body.classList.contains('dark-mode'),
                    bgColor: document.querySelector('.custom-color-option.active')?.dataset.color || '#ffffff',
                    tocPosition: document.querySelector('input[name="tocPosition"]:checked')?.value || 'right'
                };
                localStorage.setItem('mdViewerSettings', JSON.stringify(settings));
                alert('ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            });

            const resetSettingsBtnMobile = document.getElementById('resetSettings-mobile');
            if(resetSettingsBtnMobile) resetSettingsBtnMobile.addEventListener('click', () => {
                localStorage.removeItem('mdViewerSettings');
                location.reload();
            });

            // Mobile Menu
            const controlsMenuBtn = document.getElementById('controlsMenuBtn');
            const controlsMenu = document.getElementById('controlsMenu');
            if(controlsMenuBtn && controlsMenu) {
                controlsMenuBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    controlsMenu.classList.toggle('open');
                });
                
                document.addEventListener('click', (e) => {
                    if (!controlsMenuBtn.contains(e.target) && !controlsMenu.contains(e.target)) {
                        controlsMenu.classList.remove('open');
                    }
                });
            }

            // --- Table of Contents (TOC) Logic ---
            const tocToggleBtnDesktop = document.getElementById('tocToggleBtnDesktop'); // Desktop
            const tocToggleBtnMobile = document.getElementById('tocToggleBtnMobile'); // Mobile
            const tocFloatingBtn = document.getElementById('tocFloatingBtn'); // Floating
            const tocDrawer = document.getElementById('tocDrawer');
            const tocOverlay = document.getElementById('tocOverlay');
            const tocCloseBtn = document.getElementById('tocCloseBtn');
            const tocList = document.getElementById('tocList');
            const tocPosLeft = document.getElementById('tocPosLeft');
            const tocPosRight = document.getElementById('tocPosRight');

            function generateTOC() {
                const headers = markdownBody.querySelectorAll('h1, h2, h3, h4, h5, h6');
                tocList.innerHTML = '';

                headers.forEach((header, index) => {
                    // Assign ID if not present
                    if (!header.id) {
                        header.id = `header-${index}`;
                    }

                    const li = document.createElement('li');
                    li.className = `toc-item ${header.tagName.toLowerCase()}`;
                    
                    const link = document.createElement('a');
                    link.className = 'toc-link';
                    link.href = `#${header.id}`;
                    link.textContent = header.textContent;
                    
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        header.scrollIntoView({ behavior: 'smooth' });
                        closeTOC();
                    });

                    li.appendChild(link);
                    tocList.appendChild(li);
                });
            }

            function openTOC() {
                tocDrawer.classList.add('open');
                tocOverlay.classList.add('open');
            }

            function closeTOC() {
                tocDrawer.classList.remove('open');
                tocOverlay.classList.remove('open');
            }
            
            function toggleTOC() {
                if (tocDrawer.classList.contains('open')) {
                    closeTOC();
                } else {
                    openTOC();
                }
            }

            if(tocToggleBtnDesktop) {
                tocToggleBtnDesktop.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleTOC();
                });
            }
            
            if(tocToggleBtnMobile) {
                tocToggleBtnMobile.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleTOC();
                });
            }
            
            if(tocFloatingBtn) {
                tocFloatingBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleTOC();
                });
            }
            
            if(tocCloseBtn) tocCloseBtn.addEventListener('click', closeTOC);
            if(tocOverlay) tocOverlay.addEventListener('click', closeTOC);
            
            // TOC Position Change
            function setTOCPosition(position) {
                if (position === 'left') {
                    tocDrawer.classList.add('left');
                } else {
                    tocDrawer.classList.remove('left');
                }
            }

            if(tocPosLeft) {
                tocPosLeft.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        setTOCPosition('left');
                    }
                });
            }

            if(tocPosRight) {
                tocPosRight.addEventListener('change', (e) => {
                    if (e.target.checked) {
                        setTOCPosition('right');
                    }
                });
            }
            
            // Load Settings (after TOC variables and functions are defined)
            const saved = localStorage.getItem('mdViewerSettings');
            if (saved) {
                try {
                    const settings = JSON.parse(saved);
                    if (settings.fontSize) updateFontSize(settings.fontSize);
                    if (settings.lineHeight) updateLineHeight(settings.lineHeight);
                    if (settings.fontFamily) {
                        const fontSelect = document.getElementById('fontFamily');
                        if(fontSelect) fontSelect.value = settings.fontFamily;
                        const fontSelectMobile = document.getElementById('fontFamily-mobile');
                        if(fontSelectMobile) fontSelectMobile.value = settings.fontFamily;
                        document.body.style.fontFamily = settings.fontFamily;
                        markdownBody.style.fontFamily = settings.fontFamily;
                    }
                    if (settings.bgColor) {
                        const btn = document.querySelector(`.custom-color-option[data-color="${settings.bgColor}"]`);
                        if (btn) btn.click();
                    }
                    if (settings.darkMode) toggleDarkMode();
                    if (settings.tocPosition) {
                        if (settings.tocPosition === 'left') {
                            if(tocPosLeft) tocPosLeft.checked = true;
                            setTOCPosition('left');
                        } else {
                            if(tocPosRight) tocPosRight.checked = true;
                            setTOCPosition('right');
                        }
                    } else {
                        // Default to right if not saved
                        if(tocPosRight) tocPosRight.checked = true;
                        setTOCPosition('right');
                    }
                } catch(e) {
                    console.error('Failed to load settings', e);
                }
            } else {
                // No saved settings - set default to right
                if (tocPosRight) {
                    tocPosRight.checked = true;
                    setTOCPosition('right');
                }
            }
            
            // F2 Shortcut for TOC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'F2') {
                    e.preventDefault();
                    toggleTOC();
                }
            });

            // Generate TOC on load
            generateTOC();

            // --- Code Block Copy Logic ---
            function addCopyButtons() {
                const preBlocks = markdownBody.querySelectorAll('pre');
                preBlocks.forEach(pre => {
                    // Check if it already has a button
                    if (pre.querySelector('.copy-btn')) return;

                    const button = document.createElement('button');
                    button.className = 'copy-btn';
                    button.title = 'Copy code';
                    // Icon for copy
                    button.innerHTML = `<svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>`;

                    button.addEventListener('click', async () => {
                        const code = pre.querySelector('code');
                        if (!code) return;

                        try {
                            await navigator.clipboard.writeText(code.innerText);
                            // Change to Check icon temporarily
                            const originalHTML = button.innerHTML;
                            button.innerHTML = `<svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>`;
                            setTimeout(() => {
                                button.innerHTML = originalHTML;
                            }, 2000);
                        } catch (err) {
                            console.error('Failed to copy:', err);
                        }
                    });

                    pre.appendChild(button);
                });
            }

            addCopyButtons();
            
            // --- Top Button & Floating TOC Logic ---
            const topBtn = document.getElementById('topBtn');
            
            function toggleFloatingButtons() {
                const shouldShow = window.scrollY > 300 || document.documentElement.scrollTop > 300;
                
                if (topBtn) {
                    if (shouldShow) topBtn.classList.add('show');
                    else topBtn.classList.remove('show');
                }
                
                if (tocFloatingBtn) {
                    if (shouldShow) tocFloatingBtn.classList.add('show');
                    else tocFloatingBtn.classList.remove('show');
                }
            }
            
            function scrollToTop() {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            }
            
            window.addEventListener('scroll', toggleFloatingButtons);
            if(topBtn) topBtn.addEventListener('click', scrollToTop);
            
            // Home key to scroll to top
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Home') {
                    // Ignore if focus is in input
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
                    e.preventDefault();
                    scrollToTop();
                }
            });

            // --- Image Lightbox Logic ---
            const lightboxOverlay = document.getElementById('lightboxOverlay');
            const lightboxImage = document.getElementById('lightboxImage');
            const lightboxClose = document.getElementById('lightboxClose');

            function openLightbox(imageSrc, imageAlt) {
                lightboxImage.src = imageSrc;
                lightboxImage.alt = imageAlt;
                lightboxOverlay.classList.add('active');
                document.body.style.overflow = 'hidden';
            }

            function closeLightbox() {
                lightboxOverlay.classList.remove('active');
                document.body.style.overflow = '';
                lightboxImage.src = '';
            }

            // Add click event to all images in markdown body
            const images = markdownBody.querySelectorAll('img');
            images.forEach(img => {
                img.addEventListener('click', (e) => {
                    e.stopPropagation();
                    openLightbox(img.src, img.alt);
                });
            });

            // Close lightbox on close button click
            if(lightboxClose) {
                lightboxClose.addEventListener('click', (e) => {
                    e.stopPropagation();
                    closeLightbox();
                });
            }

            // Close lightbox on overlay click
            if(lightboxOverlay) {
                lightboxOverlay.addEventListener('click', closeLightbox);
            }

            // Prevent closing when clicking on image itself
            if(lightboxImage) {
                lightboxImage.addEventListener('click', (e) => {
                    e.stopPropagation();
                });
            }

            // Close lightbox on ESC key
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && lightboxOverlay.classList.contains('active')) {
                    closeLightbox();
                }
            });

            // --- Raw Markdown View Logic ---
            const rawToggleBtn = document.getElementById('rawToggleBtn');
            let isRawView = false;
            let savedHtmlContent = '';
            let rawMarkdownContent = '';
            let isFetchingRaw = false;

            async function displayRaw() {
                // Toggle between rendered and raw view
                if (!isRawView) {
                    // Switch to Raw view
                    if (!rawMarkdownContent && !isFetchingRaw) {
                        // Get markdown from hidden script tag
                        const rawSource = document.getElementById('rawMarkdownSource');
                        if (rawSource) {
                            rawMarkdownContent = rawSource.textContent;
                        } else {
                            alert('ë§ˆí¬ë‹¤ìš´ ì†ŒìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            return;
                        }
                    }

                    // Save current HTML content
                    savedHtmlContent = markdownBody.innerHTML;

                    // Get current font family from control box
                    const currentFont = document.getElementById('fontFamily')?.value || "'Noto Sans KR', sans-serif";

                    // Display raw markdown with current font settings and copy button
                    markdownBody.innerHTML = `
                        <div style="position: relative;">
                            <button id="rawCopyBtn" style="position: absolute; top: 12px; right: 12px; background-color: rgba(255, 255, 255, 0.9); border: 1px solid #ddd; border-radius: 4px; padding: 6px 12px; font-size: 12px; color: #666; cursor: pointer; z-index: 10; display: flex; align-items: center; gap: 4px;" title="ì „ì²´ ë³µì‚¬">
                                <svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                                <span>ë³µì‚¬</span>
                            </button>
                            <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: ${currentFont}; font-size: 14px; line-height: 1.6; padding: 16px; margin: 0; background-color: #f6f8fa; border-radius: 6px; overflow-x: auto;"><code>${escapeHtml(rawMarkdownContent)}</code></pre>
                        </div>
                    `;
                    
                    // Add copy button event listener
                    const rawCopyBtn = document.getElementById('rawCopyBtn');
                    if (rawCopyBtn) {
                        rawCopyBtn.addEventListener('click', async () => {
                            try {
                                await navigator.clipboard.writeText(rawMarkdownContent);
                                const originalHTML = rawCopyBtn.innerHTML;
                                rawCopyBtn.innerHTML = `<svg width="14" height="14" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg><span>ë³µì‚¬ë¨!</span>`;
                                rawCopyBtn.style.backgroundColor = '#d4edda';
                                rawCopyBtn.style.color = '#155724';
                                setTimeout(() => {
                                    rawCopyBtn.innerHTML = originalHTML;
                                    rawCopyBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.9)';
                                    rawCopyBtn.style.color = '#666';
                                }, 2000);
                            } catch (err) {
                                console.error('Failed to copy:', err);
                                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                            }
                        });
                    }
                    
                    isRawView = true;
                    rawToggleBtn.style.backgroundColor = '#0ea5e9';
                    rawToggleBtn.style.color = 'white';
                } else {
                    // Switch back to rendered view
                    markdownBody.innerHTML = savedHtmlContent;
                    
                    // Re-attach image lightbox listeners
                    const images = markdownBody.querySelectorAll('img');
                    images.forEach(img => {
                        img.addEventListener('click', (e) => {
                            e.stopPropagation();
                            openLightbox(img.src, img.alt);
                        });
                    });

                    // Re-attach copy buttons to code blocks
                    addCopyButtons();

                    // Re-generate TOC
                    generateTOC();
                    
                    isRawView = false;
                    rawToggleBtn.style.backgroundColor = '';
                    rawToggleBtn.style.color = '';
                }
            }

            function escapeHtml(text) {
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }

            if (rawToggleBtn) {
                rawToggleBtn.addEventListener('click', displayRaw);
            }

            // --- Export Functionality ---
            const exportBtn = document.getElementById('exportBtn');
            const exportMenu = document.getElementById('exportMenu');
            const exportHTMLBtn = document.getElementById('exportHTML');
            const exportPDFBtn = document.getElementById('exportPDF');

            // Toggle export menu
            if (exportBtn) {
                exportBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    exportMenu.classList.toggle('show');
                });
            }

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (exportMenu && !exportMenu.contains(e.target) && e.target !== exportBtn) {
                    exportMenu.classList.remove('show');
                }
            });

            // Export as HTML
            if (exportHTMLBtn) {
                exportHTMLBtn.addEventListener('click', () => {
                    exportMenu.classList.remove('show');
                    
                    // Get all styles
                    let styles = '';
                    for (let sheet of document.styleSheets) {
                        try {
                            for (let rule of sheet.cssRules) {
                                styles += rule.cssText + '\n';
                            }
                        } catch (e) {
                            // Skip external stylesheets due to CORS
                        }
                    }

                    const html = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Export</title>
    <style>
${styles}
    </style>
</head>
<body>
    <div class="markdown-body">
${markdownBody.innerHTML}
    </div>
</body>
</html>`;

                    const blob = new Blob([html], { type: 'text/html;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'markdown-export.html';
                    a.click();
                    URL.revokeObjectURL(url);
                });
            }

            // Export as PDF
            if (exportPDFBtn) {
                exportPDFBtn.addEventListener('click', async () => {
                    exportMenu.classList.remove('show');
                    
                    // Show loading indicator
                    const originalText = exportPDFBtn.innerHTML;
                    exportPDFBtn.innerHTML = 'â³ PDF ìƒì„± ì¤‘...';
                    exportPDFBtn.disabled = true;

                    try {
                        const element = markdownBody.cloneNode(true);
                        
                        // PDF export options
                        const opt = {
                            margin: 10,
                            filename: 'markdown-export.pdf',
                            image: { type: 'jpeg', quality: 0.98 },
                            html2canvas: { scale: 2, useCORS: true },
                            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                        };

                        await html2pdf().set(opt).from(element).save();
                    } catch (error) {
                        console.error('PDF export failed:', error);
                        alert('PDF ë‚´ë³´ë‚´ê¸°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                    } finally {
                        exportPDFBtn.innerHTML = originalText;
                        exportPDFBtn.disabled = false;
                    }
                });
            }
        });
    </script>
</body>
</html>
